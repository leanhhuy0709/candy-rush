(()=>{"use strict";var e,t={11:(e,t,i)=>{var s=i(260);const r={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:72,margin:10,candyTypes:["cookie1","cookie2","croissant","cupcake","donut","eclair","macaroon","pie","poptart1","poptart2","starcookie1","starcookie2"]};var h;!function(e){e.LOADING="LoadingScene",e.GAMEPLAY="GamePlayScene"}(h||(h={}));class n extends Phaser.GameObjects.Image{constructor(e,t,i){super(e.scene,e.x,e.y,e.texture,e.frame),this.setOrigin(.5,.5).setInteractive().setDepth(5),this.gridX=t,this.gridY=i,this.graphics=this.scene.add.graphics().lineStyle(2,12183295).setVisible(!1).setDepth(4),this.graphics.strokeRoundedRect(0,0,this.width+2,this.height),this.setGraphics(),this.scene.add.existing(this),this.tween=this.scene.tweens.add({targets:this,angle:360,duration:1500,ease:"Linear",repeat:-1,yoyo:!0}),this.tween.pause()}spin(){this.tween.resume()}unSpin(){this.tween.pause(),this.scene.tweens.add({targets:this,angle:0,duration:500,ease:"Power2"})}showGraphics(){this.setGraphics(),this.graphics.setVisible(!0)}hideGraphics(){this.graphics.setVisible(!1)}setGraphics(){const e=this.width+2,t=this.height;this.graphics.x=this.x-e/2,this.graphics.y=this.y-t/2}getKey(){return this.texture.key}selectEffect(){this.spin(),this.showGraphics()}unSelectEffect(){this.unSpin(),this.hideGraphics()}updatePositon(e=!0,t){const i=this.scene.cameras.main.width,s=r.tileWidth/2+this.gridX*(r.tileWidth+r.margin)+(i-(r.tileWidth+r.margin)*r.gridWidth),h=r.tileHeight/2+this.gridY*(r.tileHeight+r.margin);e?(n.numTweenRunning++,this.scene.tweens.add({targets:this,x:s,y:h,duration:1e3,ease:"Power3",onComplete:()=>{n.numTweenRunning--,t&&0==n.numTweenRunning&&t()}})):(this.x=s,this.y=h)}setRandomTextures(){this.setTexture(r.candyTypes[Phaser.Math.RND.between(0,r.candyTypes.length-1)])}}n.numTweenRunning=0;class l extends Phaser.Scene{constructor(){super({key:h.GAMEPLAY})}create(){this.tileMap=new Map,this.firstSelectedTile=null,this.secondSelectedTile=null;for(let e=0;e<r.gridHeight;e++)for(let t=0;t<r.gridWidth;t++)this.setTile(e,t,this.getRandomTile(e,t));this.input.on("gameobjectdown",this.onTileClicked,this);const e=this.cameras.main.width/2,t=this.cameras.main.height/2;for(let i=0;i<r.gridHeight;i++)for(let s=0;s<r.gridWidth;s++){const h=this.getTile(i,s),n=(i*r.gridWidth+s)/(r.gridHeight*r.gridWidth)*360;h.temp=n,this.tweens.add({targets:h,temp:360+n,R:0,duration:1500,ease:"Power2",onStart:()=>{h.R=200},onComplete:()=>{var e;null===(e=this.getTile(i,s))||void 0===e||e.updatePositon(!0,(()=>{this.handleMatch()}))},onUpdate:()=>{const i=h.temp%360,s=h.R;if(90==i)return h.x=e,void(h.y=s+t);if(270==i)return h.x=e,void(h.y=-s+t);const r=Math.tan(i*Math.PI/180);i<90&&i>=0?(h.x=s/Math.sqrt(1+Math.pow(r,2))+e,h.y=r*(h.x-e)+t):i<180&&i>90||i<270&&i>=180?(h.x=-s/Math.sqrt(1+Math.pow(r,2))+e,h.y=r*(h.x-e)+t):i<=360&&i>270&&(h.x=s/Math.sqrt(1+Math.pow(r,2))+e,h.y=r*(h.x-e)+t)}})}}update(){}getRandomTile(e,t){const i=r.candyTypes[Phaser.Math.RND.between(0,r.candyTypes.length-1)];return new n({scene:this,x:this.cameras.main.width/2,y:this.cameras.main.height/2,texture:i},e,t)}onTileClicked(e,t){this.firstSelectedTile?this.secondSelectedTile||(this.secondSelectedTile=t,this.secondSelectedTile.selectEffect(),this.isValidSelect()?this.swapTiles((()=>{this.firstSelectedTile&&this.secondSelectedTile&&(this.firstSelectedTile.unSelectEffect(),this.secondSelectedTile.unSelectEffect(),this.handleMatch((()=>this.resetSelect())))})):(this.firstSelectedTile.unSelectEffect(),this.secondSelectedTile.unSelectEffect(),this.resetSelect())):(this.firstSelectedTile=t,this.firstSelectedTile.selectEffect())}resetSelect(){this.firstSelectedTile=null,this.secondSelectedTile=null}isValidSelect(){return!(!this.firstSelectedTile||!this.secondSelectedTile)}swapTiles(e){if(this.firstSelectedTile&&this.secondSelectedTile){const t=this.firstSelectedTile.x,i=this.firstSelectedTile.y,s=this.secondSelectedTile.x,r=this.secondSelectedTile.y,h=500,n=this.tweens.add({targets:[this.firstSelectedTile],x:s,y:r,duration:h,ease:"Linear",onComplete:()=>{l.isActive()||(this.firstSelectedTile&&this.secondSelectedTile&&this.swapTwoTiles(this.firstSelectedTile.gridX,this.firstSelectedTile.gridY,this.secondSelectedTile.gridX,this.secondSelectedTile.gridY),e(),n.destroy(),l.destroy())}}),l=this.tweens.add({targets:[this.secondSelectedTile],x:t,y:i,duration:h,ease:"Linear",onComplete:()=>{n.isActive()||(this.firstSelectedTile&&this.secondSelectedTile&&this.swapTwoTiles(this.firstSelectedTile.gridX,this.firstSelectedTile.gridY,this.secondSelectedTile.gridX,this.secondSelectedTile.gridY),e(),n.destroy(),l.destroy())}})}}swapTwoTiles(e,t,i,s){const r=this.getTile(e,t),h=this.getTile(i,s);r&&h?(this.setTile(e,t,h),this.setTile(i,s,r),r.gridX=i,r.gridY=s,h.gridX=e,h.gridY=t):console.log("Error swap!")}getTile(e,t){return this.tileMap.get(e.toString()+t.toString())}setTile(e,t,i){this.tileMap.set(e.toString()+t.toString(),i)}removeTile(e,t){this.tileMap.delete(e.toString()+t.toString())}handleMatch(e){const t=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}],i=[];for(let e=0;e<r.gridWidth;e++)i.push(0);const s=[];for(let e=0;e<r.gridHeight;e++)for(let h=0;h<r.gridWidth;h++){const r=this.getTile(e,h);r||console.log("Error index tile!");for(let n=0;n<t.length;n++){const l=this.getTile(e+t[n].x,h+t[n].y);if(l&&l.getKey()===r.getKey()){const l=this.getTile(e-t[n].x,h-t[n].y),a=this.getTile(e+2*t[n].x,h+2*t[n].y);if(l&&l.getKey()===r.getKey()||a&&a.getKey()===r.getKey()){i[r.gridX]++,s.push({x:e,y:h,newY:-i[r.gridX]});break}}}}for(let e=0;e<s.length;e++){const t=s[e],i=this.getTile(t.x,t.y);if(i){const e=this.add.text(i.x,i.y+10,"100",{fontFamily:"Cambria",fontSize:25,color:"#ffffff"}).setDepth(6).setOrigin(.5,.5).setAlpha(0).setStroke("#000000",2),s=this.tweens.add({targets:e,alpha:1,duration:700,y:i.y,onComplete:()=>{e.destroy(),s.destroy()}});this.removeTile(t.x,t.y),i.gridY=t.newY,this.setTile(t.x,t.newY,i),i.updatePositon(!1),i.setRandomTextures(),i.angle=0}}if(s.length)for(let e=0;e<r.gridWidth;e++){let t=0;for(let s=r.gridHeight-1;s>=-i[e];s--){const i=this.getTile(e,s);i?t>0&&(this.removeTile(e,s),i.gridY=s+t,this.setTile(e,s+t,i),i.updatePositon(!0,(()=>{this.handleMatch()}))):t++}}e&&e()}}class a extends Phaser.Scene{constructor(){super({key:h.LOADING})}preload(){this.cameras.main.setBackgroundColor(10016391),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GamePlayScene")}}const d={title:"Candy Rush",url:"https://github.com/leanhhuy0709/candy-rush",version:"2.0",type:Phaser.AUTO,parent:"Game",scene:[a,l],input:{keyboard:!0},width:600,height:800,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.Center.CENTER_BOTH},backgroundColor:"#63289e",render:{pixelArt:!1,antialias:!0}};class c extends s.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new c(d)}))}},i={};function s(e){var r=i[e];if(void 0!==r)return r.exports;var h=i[e]={exports:{}};return t[e].call(h.exports,h,h.exports,s),h.exports}s.m=t,e=[],s.O=(t,i,r,h)=>{if(!i){var n=1/0;for(c=0;c<e.length;c++){for(var[i,r,h]=e[c],l=!0,a=0;a<i.length;a++)(!1&h||n>=h)&&Object.keys(s.O).every((e=>s.O[e](i[a])))?i.splice(a--,1):(l=!1,h<n&&(n=h));if(l){e.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}h=h||0;for(var c=e.length;c>0&&e[c-1][2]>h;c--)e[c]=e[c-1];e[c]=[i,r,h]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var r,h,[n,l,a]=i,d=0;if(n.some((t=>0!==e[t]))){for(r in l)s.o(l,r)&&(s.m[r]=l[r]);if(a)var c=a(s)}for(t&&t(i);d<n.length;d++)h=n[d],s.o(e,h)&&e[h]&&e[h][0](),e[h]=0;return s.O(c)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var r=s.O(void 0,[216],(()=>s(11)));r=s.O(r)})();