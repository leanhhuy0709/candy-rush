(()=>{"use strict";var e,t={309:(e,t,i)=>{var s=i(260);const h={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:72,margin:10,candyTypes:["cookie1","cookie2","croissant","cupcake","donut","eclair"]};var l;!function(e){e.LOADING="LoadingScene",e.GAMEPLAY="GamePlayScene"}(l||(l={}));const r=[0,1e3,3e3,5500,7e3,9e3,1e4,13e3,15e3,18e3,22e4,1e6];class n{constructor(e){this.level=1,this.scene=e,this.score=0,this.scoreText=e.add.text(e.cameras.main.width/2,50,"0",{fontFamily:"Cambria",fontSize:55,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(6).setOrigin(.5,.5);const t=this.scene.add.graphics();t.lineStyle(3,15546518).setDepth(9).strokeRoundedRect(30,50,175,20,5),t.fillStyle(11622),t.fillRoundedRect(30,50,175,20,5).setDepth(4),this.progressBar=this.scene.add.graphics().fillStyle(16110006).fillRoundedRect(30,50,100,20,5).setDepth(5),this.updateProgressBar(0),this.targetText=e.add.text(117.5,30,`${r[this.level]}`,{fontFamily:"Cambria",fontSize:20,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(6).setOrigin(.5,.5)}addScore(e){this.score+=e,this.scoreText.setText(this.score.toString()),this.updateProgressBar((this.score-r[this.level-1])/(r[this.level]-r[this.level-1]))}updateProgressBar(e){e<=.05&&(e=.05),e>1&&(e=1),this.progressBar.clear(),this.progressBar.fillStyle(16110006).fillRoundedRect(30,50,175*e,20,5).setDepth(5)}handleGoToNextLevel(){this.score>=r[this.level]&&(this.level++,this.targetText.setText(`${r[this.level]}`),this.updateProgressBar((this.score-r[this.level-1])/(r[this.level]-r[this.level-1])),this.scene.shuffle())}}class o extends Phaser.GameObjects.Image{constructor(e,t,i){super(e.scene,e.x,e.y,e.texture,e.frame),this.setOrigin(.5,.5).setInteractive().setDepth(5),this.gridX=t,this.gridY=i,this.graphics=this.scene.add.graphics().lineStyle(2,12183295).setVisible(!1).setDepth(4),this.graphics.strokeRoundedRect(0,0,this.width+2,this.height),this.setGraphics(),this.scene.add.existing(this),this.tween=this.scene.tweens.add({targets:this,angle:360,duration:1500,ease:"Linear",repeat:-1}),this.tween.pause(),this.hintTween=this.scene.tweens.add({targets:this,scale:.8,duration:500,ease:"Linear",repeat:-1,yoyo:!0}),this.hintTween.pause()}spin(){this.tween.resume()}unSpin(){this.tween.pause(),this.scene.tweens.add({targets:this,angle:0,duration:500,ease:"Power2"})}showGraphics(){this.setGraphics(),this.graphics.setVisible(!0)}hideGraphics(){this.graphics.setVisible(!1)}setGraphics(){const e=this.width+2,t=this.height;this.graphics.x=this.x-e/2,this.graphics.y=this.y-t/2}getKey(){return this.texture.key}selectEffect(){this.spin(),this.showGraphics()}unSelectEffect(){this.unSpin(),this.hideGraphics()}updatePositon(e=!0,t,i,s){const l=this.scene.cameras.main.width;let r=500;s&&(r=s),i||(i=0);const n=h.tileWidth/2+this.gridX*(h.tileWidth+h.margin)+(l-(h.tileWidth+h.margin)*h.gridWidth),a=h.tileHeight/2+this.gridY*(h.tileHeight+h.margin)+100;e?(o.numTweenRunning++,this.scene.tweens.add({targets:this,x:n,y:a,delay:i,duration:r,ease:"Power2",onComplete:()=>{o.numTweenRunning--,t&&0==o.numTweenRunning&&t()}})):(this.x=n,this.y=a)}goToPosition(e,t,i,s){this.scene.tweens.add({targets:this,x:e,y:t,delay:s,duration:500,ease:"Power2",onComplete:()=>{i&&i()}})}setRandomTextures(){let e=h.candyTypes[Phaser.Math.RND.between(0,h.candyTypes.length-1)];if(Math.random()<.1){const t=this.gridX;let i=this.gridY;i<0&&(i=1);const s=this.scene,h=[];s.getTile(t-1,i)&&h.push(s.getTile(t-1,i)),s.getTile(t+1,i)&&h.push(s.getTile(t+1,i)),s.getTile(t,i-1)&&h.push(s.getTile(t,i-1)),s.getTile(t,i+1)&&h.push(s.getTile(t,i+1)),h.length>0&&(e=h[Phaser.Math.Between(0,h.length-1)].getKey())}this.setTexture(e)}showHint(){this.hintTween.resume(),this.showGraphics()}hideHint(){this.hintTween.pause(),this.scene.tweens.add({targets:this,scale:1,duration:1e3,ease:"Linear"}),this.hideGraphics()}}var a;o.numTweenRunning=0,function(e){e[e.IDLE=0]="IDLE",e[e.HANDLING=1]="HANDLING"}(a||(a={}));const d=["#ffffff","#bcffe3","#20b2aa","#ff1919"];class c extends Phaser.Scene{constructor(){super({key:l.GAMEPLAY})}create(){this.add.image(0,0,"bg").setOrigin(0,0),this.tileMap=new Map;for(let e=0;e<h.gridHeight;e++)for(let t=0;t<h.gridWidth;t++)this.setTile(e,t,this.getRandomTile(e,t));this.firstSelectedTile=this.getTile(0,0),this.secondSelectedTile=this.getTile(0,1),this.scoreBoard=new n(this),this.boardState=a.HANDLING,this.shuffle(),this.input.on("gameobjectdown",this.onTileClicked,this),new Phaser.Geom.Circle(0,0,160);const e=new Phaser.Geom.Line(400,300,30,50);this.add.particles(400,300,"flares",{frame:{frames:["red","green","blue","white","yellow"],cycle:!0},blendMode:"ADD",lifespan:{min:200,max:500},quantity:4,scale:{start:.3,end:.1},speed:{min:50,max:100}}).addEmitZone({type:"edge",source:e,quantity:64,total:1})}update(e,t){0==this.idleTime&&(this.isIdleTweenPlaying=!1),this.idleTime+=t,this.handleIdleTime(),this.boardState==a.IDLE&&this.scoreBoard.handleGoToNextLevel()}getRandomTile(e,t){const i=h.candyTypes[Phaser.Math.RND.between(0,h.candyTypes.length-1)];return new o({scene:this,x:this.cameras.main.width/2,y:this.cameras.main.height/2,texture:i},e,t)}onTileClicked(e,t){this.idleTime=0,this.firstSelectedTile?this.secondSelectedTile||(this.secondSelectedTile=t,this.secondSelectedTile.selectEffect(),this.isValidSelect()?this.swapTiles((()=>{this.firstSelectedTile&&this.secondSelectedTile&&(this.firstSelectedTile.unSelectEffect(),this.secondSelectedTile.unSelectEffect(),this.boardState=a.HANDLING,this.handleMatch(((e=!0)=>{this.resetSelect(),this.boardState=a.IDLE})))})):(this.firstSelectedTile.unSelectEffect(),this.secondSelectedTile.unSelectEffect(),this.resetSelect())):(this.firstSelectedTile=t,this.firstSelectedTile.selectEffect())}resetSelect(){this.firstSelectedTile=null,this.secondSelectedTile=null}isValidSelect(){return!0}swapTiles(e){if(this.firstSelectedTile&&this.secondSelectedTile){const t=this.firstSelectedTile.x,i=this.firstSelectedTile.y,s=this.secondSelectedTile.x,h=this.secondSelectedTile.y,l=500,r=this.tweens.add({targets:[this.firstSelectedTile],x:s,y:h,duration:l,ease:"Linear",onComplete:()=>{n.isActive()||(this.firstSelectedTile&&this.secondSelectedTile&&this.swapTwoTiles(this.firstSelectedTile.gridX,this.firstSelectedTile.gridY,this.secondSelectedTile.gridX,this.secondSelectedTile.gridY),e(),r.destroy(),n.destroy())}}),n=this.tweens.add({targets:[this.secondSelectedTile],x:t,y:i,duration:l,ease:"Linear",onComplete:()=>{r.isActive()||(this.firstSelectedTile&&this.secondSelectedTile&&this.swapTwoTiles(this.firstSelectedTile.gridX,this.firstSelectedTile.gridY,this.secondSelectedTile.gridX,this.secondSelectedTile.gridY),e(),r.destroy(),n.destroy())}})}}swapTwoTiles(e,t,i,s){const h=this.getTile(e,t),l=this.getTile(i,s);h&&l?(this.setTile(e,t,l),this.setTile(i,s,h),h.gridX=i,h.gridY=s,l.gridX=e,l.gridY=t):console.log("Error swap!")}getTile(e,t){return this.tileMap.get(e.toString()+t.toString())}setTile(e,t,i){this.tileMap.set(e.toString()+t.toString(),i)}removeTile(e,t){this.tileMap.delete(e.toString()+t.toString())}handleMatch(e,t=0){this.idleTime=0;const i=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}],s=[];for(let e=0;e<h.gridWidth;e++)s.push(0);const l=[],r=new Map;let n=1;const o=[0];for(let e=0;e<h.gridHeight;e++)for(let t=0;t<h.gridWidth;t++){const h=this.getTile(e,t);h||console.log("Error index tile!");for(let a=0;a<i.length;a++){const d=this.getTile(e+i[a].x,t+i[a].y);if(d&&d.getKey()===h.getKey()){const d=this.getTile(e-i[a].x,t-i[a].y),c=this.getTile(e+2*i[a].x,t+2*i[a].y);let g;const T=r.get(this.convertToKey(e,t)),f=r.get(this.convertToKey(e+i[a].x,t+i[a].y));if(T&&(g=T),f&&(g=f),d&&d.getKey()===h.getKey()){s[h.gridX]++,l.push({x:e,y:t,newY:-s[h.gridX]});const d=r.get(this.convertToKey(e-i[a].x,t-i[a].y));d&&(g=d),null==g&&(g=n,o.push(0),n++),T!=g&&(r.set(this.convertToKey(e,t),g),o[g]++),f!=g&&(r.set(this.convertToKey(e+i[a].x,t+i[a].y),g),o[g]++),d!=g&&(r.set(this.convertToKey(e-i[a].x,t-i[a].y),g),o[g]++);break}if(c&&c.getKey()===h.getKey()){s[h.gridX]++,l.push({x:e,y:t,newY:-s[h.gridX]});const d=r.get(this.convertToKey(e+2*i[a].x,t+2*i[a].y));d&&(g=d),null==g&&(g=n,o.push(0),n++),T!=g&&(r.set(this.convertToKey(e,t),g),o[g]++),f!=g&&(r.set(this.convertToKey(e+i[a].x,t+i[a].y),g),o[g]++),d!=g&&(r.set(this.convertToKey(e+2*i[a].x,t+2*i[a].y),g),o[g]++);break}}}}const a=[];for(let e=0;e<o.length;e++)a.push({x:0,y:0,gridX:0,gridY:0});for(let e=0;e<l.length;e++){const t=l[e],i=this.getTile(t.x,t.y);if(i){const e=r.get(this.convertToKey(t.x,t.y));a[e].x+=i.x,a[e].y+=i.y+10,a[e].gridX+=i.gridX,a[e].gridY+=i.gridY,this.removeTile(t.x,t.y),i.gridY=t.newY,this.setTile(t.x,t.newY,i),i.updatePositon(!1),i.angle=0}}for(let e=1;e<o.length;e++){let i=0;switch(o[e]){case 0:case 1:case 2:console.log("Error Group");break;case 3:i=30;break;case 4:i=60;break;case 5:i=100;break;case 6:i=200;break;case 7:i=400;break;case 8:i=700;break;default:i=1e3}let h=t+e;h>=d.length&&(h=d.length-1),i*=h;const l=Math.round(a[e].gridX/o[e]),n=Math.round(a[e].gridY/o[e]);if(4==o[e]){let e;for(const[t,i]of r){const i=Number(t[0]);if(i==l){e=i;break}}if(e){const t=-s[e];s[e]--;const i=this.getTile(e,t);i?(this.removeTile(e,t),i.gridX=l,i.gridY=n,this.setTile(l,n,i),i.updatePositon(!1),i.scale=0,this.tweens.add({targets:i,scale:1,duration:2e3})):console.log("Error Tile!")}}else o[e];this.scoreBoard.addScore(i);const c=this.add.text(a[e].x/o[e],a[e].y/o[e],i.toString(),{fontFamily:"Cambria",fontSize:25,color:d[h]}).setDepth(6).setOrigin(.5,.5).setAlpha(0).setStroke("#000000",2),g=this.tweens.add({targets:c,alpha:1,duration:700,y:a[e].y/o[e]-10,onComplete:()=>{c.destroy(),g.destroy()}})}if(l.length)for(let i=0;i<h.gridWidth;i++){let l=0;for(let r=h.gridHeight-1;r>=-s[i];r--){const s=this.getTile(i,r);s?l>0&&(r<0&&s.setRandomTextures(),this.removeTile(i,r),s.gridY=r+l,this.setTile(i,r+l,s),s.updatePositon(!0,(()=>{this.handleMatch((()=>{e&&e()}),t+o.length-1)}),void 0,1300)):l++}}else e&&e(!1)}idleEffect(){for(let e=0;e<h.gridHeight;e++)for(let t=0;t<h.gridWidth;t++){const i=this.getTile(e,t);this.isIdleTweenPlaying||this.tweens.add({targets:i,angle:360,delay:(e*h.gridHeight+t)/64*1e3,duration:1e3,ease:"Linear",onComplete:()=>{}})}this.isIdleTweenPlaying=!0}handleIdleTime(){this.idleTime>5e3?(this.firstSelectedTile&&(this.firstSelectedTile.unSelectEffect(),this.firstSelectedTile=null),this.idleEffect(),this.showHint()):this.hideHint()}handleHint(){const e=[];for(let t=0;t<h.gridHeight;t++)for(let i=0;i<h.gridWidth;i++){const s=this.getTile(t,i),h=this.getTile(t,i+1),l=this.getTile(t,i+2);if(h){if(s.getKey()===h.getKey()){const h=[{T1:this.getTile(t-1,i-1),T2:this.getTile(t,i-1)},{T1:this.getTile(t+1,i-1),T2:this.getTile(t,i-1)},{T1:this.getTile(t-1,i+2),T2:this.getTile(t,i+2)},{T1:this.getTile(t+1,i+2),T2:this.getTile(t,i+2)},{T1:this.getTile(t,i-2),T2:this.getTile(t,i-1)},{T1:this.getTile(t,i+3),T2:this.getTile(t,i+2)}];for(let t=0;t<h.length;t++){const i=h[t].T1,l=h[t].T2;if(i&&l&&s.getKey()===i.getKey())return e.push(i),e.push(l),e}}if(l&&s.getKey()===l.getKey()){const h=[{T1:this.getTile(t-1,i+1),T2:this.getTile(t,i+1)},{T1:this.getTile(t+1,i+1),T2:this.getTile(t,i+1)}];for(let t=0;t<h.length;t++){const i=h[t].T1,l=h[t].T2;if(i&&l&&s.getKey()===i.getKey())return e.push(i),e.push(l),e}}}}for(let t=0;t<h.gridHeight;t++)for(let i=0;i<h.gridWidth;i++){const s=this.getTile(t,i),h=this.getTile(t+1,i),l=this.getTile(t+2,i);if(h){if(s.getKey()===h.getKey()){const h=[{T1:this.getTile(t-1,i-1),T2:this.getTile(t-1,i)},{T1:this.getTile(t-1,i+1),T2:this.getTile(t-1,i)},{T1:this.getTile(t+2,i-1),T2:this.getTile(t+2,i)},{T1:this.getTile(t+2,i+1),T2:this.getTile(t+2,i)},{T1:this.getTile(t-2,i),T2:this.getTile(t-1,i)},{T1:this.getTile(t+3,i),T2:this.getTile(t+2,i)}];for(let t=0;t<h.length;t++){const i=h[t].T1,l=h[t].T2;if(i&&l&&s.getKey()===i.getKey())return e.push(i),e.push(l),e}}if(l&&s.getKey()===l.getKey()){const h=[{T1:this.getTile(t+1,i-1),T2:this.getTile(t+1,i)},{T1:this.getTile(t+1,i+1),T2:this.getTile(t+1,i)}];for(let t=0;t<h.length;t++){const i=h[t].T1,l=h[t].T2;if(i&&l&&s.getKey()===i.getKey())return e.push(i),e.push(l),e}}}}return e}showHint(){const e=this.handleHint();if(0==e.length)return this.firstSelectedTile=this.getTile(0,0),this.secondSelectedTile=this.getTile(0,1),void this.shuffle();this.hintTile1=e[0],this.hintTile2=e[1],this.hintTile1&&this.hintTile2&&(this.hintTile1.showHint(),this.hintTile2.showHint())}hideHint(){this.hintTile1&&this.hintTile2&&(this.hintTile1.hideHint(),this.hintTile2.hideHint(),this.firstSelectedTile&&this.firstSelectedTile.showGraphics(),this.hintTile1=this.hintTile2=null)}convertToKey(e,t){return e.toString()+t.toString()}shuffle(){this.idleTime=0;const e=this.getRandomShape();for(let t=0;t<h.gridHeight;t++)for(let i=0;i<h.gridWidth;i++){const s=this.getTile(t,i);s.setRandomTextures();const l={value:(t*h.gridHeight+i)/(h.gridHeight*h.gridWidth)},r=this.getPointFromShape(e,l.value);s.goToPosition(r.x,r.y,(()=>{this.tweens.add({targets:l,value:(t*h.gridHeight+i)/(h.gridHeight*h.gridWidth)+1,duration:1e3,ease:"Linear",onComplete:()=>{var e;null===(e=this.getTile(t,i))||void 0===e||e.updatePositon(!0,(()=>{this.handleMatch((()=>{this.idleTime=0,this.firstSelectedTile=null,this.secondSelectedTile=null,this.boardState=a.IDLE}))}),Phaser.Math.Between(0,500))},onUpdate:()=>{let t=l.value;t>1&&(t-=1);const i=this.getPointFromShape(e,t);s.x=i.x,s.y=i.y}})}))}}getRandomShape(){const e=Phaser.Math.Between(0,2),t=this.cameras.main.width/2,i=this.cameras.main.height/2;switch(e){case 0:return new Phaser.Geom.Rectangle(t-150,i-150,300,300);case 1:return new Phaser.Geom.Circle(t,i,200);default:return new Phaser.Geom.Ellipse(t,i,200,300)}}getPointFromShape(e,t){return e instanceof Phaser.Geom.Rectangle?Phaser.Geom.Rectangle.GetPoint(e,t):e instanceof Phaser.Geom.Circle?Phaser.Geom.Circle.GetPoint(e,t):Phaser.Geom.Ellipse.GetPoint(e,t)}}class g extends Phaser.Scene{constructor(){super({key:l.LOADING})}preload(){this.cameras.main.setBackgroundColor(10016391),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GamePlayScene")}}const T={title:"Candy Rush",url:"https://github.com/leanhhuy0709/candy-rush",version:"2.0",type:Phaser.AUTO,parent:"Game",scene:[g,c],input:{keyboard:!0},width:600,height:800,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.Center.CENTER_BOTH},backgroundColor:"#63289e",render:{pixelArt:!1,antialias:!0}};class f extends s.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new f(T)}))}},i={};function s(e){var h=i[e];if(void 0!==h)return h.exports;var l=i[e]={exports:{}};return t[e].call(l.exports,l,l.exports,s),l.exports}s.m=t,e=[],s.O=(t,i,h,l)=>{if(!i){var r=1/0;for(d=0;d<e.length;d++){for(var[i,h,l]=e[d],n=!0,o=0;o<i.length;o++)(!1&l||r>=l)&&Object.keys(s.O).every((e=>s.O[e](i[o])))?i.splice(o--,1):(n=!1,l<r&&(r=l));if(n){e.splice(d--,1);var a=h();void 0!==a&&(t=a)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[i,h,l]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var h,l,[r,n,o]=i,a=0;if(r.some((t=>0!==e[t]))){for(h in n)s.o(n,h)&&(s.m[h]=n[h]);if(o)var d=o(s)}for(t&&t(i);a<r.length;a++)l=r[a],s.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var h=s.O(void 0,[216],(()=>s(309)));h=s.O(h)})();