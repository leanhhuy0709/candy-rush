(()=>{"use strict";var e,t={476:(e,t,i)=>{var s=i(260);const r={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:72,margin:10,candyTypes:["cookie1","cookie2","croissant","cupcake","donut","eclair","macaroon","pie","poptart1","poptart2","starcookie1","starcookie2"]};var n;!function(e){e.LOADING="LoadingScene",e.GAMEPLAY="GamePlayScene",e.MENU="MenuScene"}(n||(n={}));class a{static init(e){this.scene=e}static getParticleEmitter(e,t,i,s){return this.scene.add.particles(e,t,i,s)}static removeParticleEmitter(e){e.destroy()}static getExplodeEmitter(e,t,i,s){return this.scene.add.particles(e,t,i,s)}static removeExplodeEmitter(e){e.destroy()}}a.particleEmitterList=[],a.explodeEmitterList=[];const l=30,h=175;class o extends Phaser.GameObjects.Particles.Particle{constructor(e){super(e),this.isInit=!1}update(e,t,i){const s=this.x,r=this.y,n=super.update(e,t,i),a=this.lifeCurrent/this.life,l=Phaser.Math.Easing.Quartic.In(a);return this.x=s+e*this.velocityX/1e3*l,this.y=r+e*this.velocityY/1e3*l,this.angle+=e/1e3*20,n}}class d{constructor(e){this.level=1,this.levels=[],this.scene=e,this.score=0,this.scoreText=e.add.text(e.cameras.main.width/2,50,"0",{fontFamily:"Cambria",fontSize:55,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(6).setOrigin(.5,.5);for(let e=1;e<1e3;e++)this.levels.push(e*(e+1)/2*500);this.progressBarEmitter=a.getParticleEmitter(l,60,"flares",{frame:"white",color:[9887962,9666291],colorEase:"quad.out",lifespan:500,angle:{min:-190,max:-170},scale:{start:.2,end:0,ease:"sine.out"},speed:100,advance:2e3,blendMode:"ADD"}).setDepth(6).start(),this.scene.add.graphics().lineStyle(3,15546518).setDepth(9).strokeRoundedRect(l,50,h,20,5).fillStyle(11622).fillRoundedRect(l,50,h,20,5).setDepth(4),this.progressBar=this.scene.add.graphics().fillStyle(16110006).fillRoundedRect(l,50,h,20,5).setDepth(5),this.updateProgressBar(0),this.targetText=e.add.text(117.5,30,`${this.levels[this.level]}`,{fontFamily:"Cambria",fontSize:20,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(6).setOrigin(.5,.5),this.confettiEmitter=this.scene.add.particles(0,300,"confetti",{frame:["1","2","3","4","5"],lifespan:3500,scale:{start:.3,end:.5},alpha:{start:75,end:100},angle:{min:-180,max:180},speedX:{min:300,max:800},speedY:{min:-1e3,max:-500},gravityY:1800,quantity:1,particleClass:o}).setDepth(7).stop()}addScore(e){this.score+=e,this.scoreText.setText(this.score.toString()),this.updateProgressBar((this.score-this.levels[this.level-1])/(this.levels[this.level]-this.levels[this.level-1]))}updateProgressBar(e){e<=.05&&(e=.05),e>1&&(e=1),this.progressBar.clear(),this.progressBar.fillStyle(16110006).fillRoundedRect(l,50,e*h,20,5).setDepth(5),this.progressBarEmitter.setPosition(l+e*h-5,60),e>=.1?this.progressBarEmitter.setVisible(!0):this.progressBarEmitter.setVisible(!1)}handleGoToNextLevel(){for(;this.score>=this.levels[this.level];)this.level++,this.targetText.setText(`${this.levels[this.level]}`),this.updateProgressBar((this.score-this.levels[this.level-1])/(this.levels[this.level]-this.levels[this.level-1])),this.scene.shuffle(),this.confettiEmitter.start(void 0,1e3)}emitterScoreEffect(e,t,i){const s=this.scene.add.image(e,t,"").setVisible(!1),r=a.getParticleEmitter(0,0,"flares",{frame:{frames:["red","green","blue","yellow"],cycle:!0},color:[65280],blendMode:Phaser.BlendModes.ADD,follow:s,speed:100,gravityY:300,lifespan:1e3,quantity:1,scale:{start:.3,end:.1}}).setDepth(6).start();let n=(this.score-this.levels[this.level-1])/(this.levels[this.level]-this.levels[this.level-1]);n<=.05&&(n=.05),n>1&&(n=1);const o=this.scene.tweens.add({targets:s,x:l+n*h,y:70,duration:1e3,onComplete:()=>{s.destroy(),r.setX(0),r.setY(0),a.removeParticleEmitter(r),o.destroy(),i&&i()}})}static caculateScore(e){switch(e){case 3:return 30;case 4:return 50;case 5:return 90;case 6:return 170;case 7:return 330;case 8:return 600;case 9:return 1e3;case 10:return 2e3;default:return 2e3+70*(e-10)}}}class c extends Phaser.GameObjects.Image{constructor(e,t,i){super(e.scene,e.x,e.y,e.texture,e.frame),this.isSuper=!1,this.isMega=!1,this.setOrigin(.5,.5).setInteractive().setDepth(5),this.gridX=t,this.gridY=i,this.scene.add.existing(this),this.tween=this.scene.tweens.add({targets:this,angle:360,duration:1500,ease:"Linear",repeat:-1}),this.tween.pause(),this.hintTween=this.scene.tweens.add({targets:this,scale:.5,duration:500,ease:"Linear",repeat:-1,yoyo:!0}),this.hintTween.pause()}spin(){this.tween.resume()}unSpin(){this.tween.pause();const e=this.scene.tweens.add({targets:this,angle:0,duration:800,ease:"Linear",onComplete:()=>e.destroy()})}showGraphics(){}hideGraphics(){}setGraphics(){}getKey(){return this.texture.key}selectEffect(){this.spin(),this.showGraphics()}unSelectEffect(){this.unSpin(),this.hideGraphics()}updatePositon(e=!0,t,i,s,n){const a=this.scene.cameras.main.width;let l=500;s&&(l=s),i||(i=0);const h=r.tileWidth/2+this.gridX*(r.tileWidth+r.margin)+(a-(r.tileWidth+r.margin)*r.gridWidth),o=r.tileHeight/2+this.gridY*(r.tileHeight+r.margin)+100;if(e){c.numTweenRunning++;const e=this.scene.tweens.add({targets:this,x:h,y:o,delay:i,duration:l,ease:Phaser.Math.Easing.Bounce.Out,onComplete:()=>{n&&n(),c.numTweenRunning--,t&&0==c.numTweenRunning&&t(),e.destroy()}});if(this.superEmitter){const e=this.scene.tweens.add({targets:this.superEmitter,x:h,y:o+10,delay:i,duration:l,ease:Phaser.Math.Easing.Bounce.Out,onComplete:()=>e.destroy()})}}else this.x=h,this.y=o}goToPosition(e,t,i,s,r,n){c.numTweenRunning++;const a=this.scene.tweens.add({targets:this,x:e,y:t,delay:s,duration:500,ease:"Power2",onComplete:()=>{c.numTweenRunning--,i&&i(),n&&0==c.numTweenRunning&&n(),a.destroy()}});if(this.superEmitter){const i=this.scene.tweens.add({targets:this.superEmitter,x:e,y:t+10,delay:s,duration:500,ease:Phaser.Math.Easing.Bounce.Out,onComplete:()=>i.destroy()})}}showHint(){this.hintTween.resume(),this.showGraphics()}hideHint(){this.hintTween.pause(),this.scene.tweens.add({targets:this,scale:1,duration:1e3,ease:"Linear"}),this.hideGraphics()}boom(){if(!(c.boomFlag>10))if(c.boomFlag++,this.isSuperTile()||this.isMegaTile()){const e=a.getExplodeEmitter(this.x,this.y,"flares",{frame:["red"],lifespan:400,speed:{min:150,max:250},scale:{start:.3,end:0},gravityY:150,blendMode:"ADD",emitting:!1}).setDepth(6);e.explode(16),setTimeout((()=>{a.removeExplodeEmitter(e)}),500)}else{const e=a.getExplodeEmitter(this.x,this.y,"flares",{frame:["blue"],lifespan:400,speed:{min:150,max:250},scale:{start:.3,end:0},gravityY:150,blendMode:"ADD",emitting:!1}).setDepth(6);e.explode(16),setTimeout((()=>{a.removeExplodeEmitter(e)}),1e3)}}static bigBoom(){if(c.boomFlag<=10)return;const e=a.getExplodeEmitter(300,400,"flares",{frame:["red","blue"],lifespan:1e3,speed:{min:350,max:450},scale:{start:.75,end:0},gravityY:150,blendMode:"ADD",emitting:!1}).setDepth(6);e.explode(50),setTimeout((()=>{a.removeExplodeEmitter(e)}),2e3)}setSuper(e=!0){this.isSuper=e,this.superEmitter&&(a.removeParticleEmitter(this.superEmitter),this.superEmitter=null),e&&(this.superEmitter=a.getParticleEmitter(this.x,this.y+20,"flares",{frame:"blue",color:[61696],colorEase:"quart.out",lifespan:500,angle:{min:-100,max:-80},scale:{start:.75,end:0,ease:"sine.out"},speed:{min:200,max:300},advance:2e3,blendMode:"ADD"}).setDepth(3).start())}setMega(e=!0){this.isMega=e,this.superEmitter&&(a.removeParticleEmitter(this.superEmitter),this.superEmitter=null),e&&(this.superEmitter=a.getParticleEmitter(this.x,this.y+20,"flares",{frame:["red"],color:[16711680],lifespan:500,angle:{min:-100,max:-80},scale:{start:.75,end:0,ease:"sine.out"},speed:{min:200,max:300},advance:2e3,blendMode:"ADD"}).setDepth(3).start())}isSuperTile(){return this.isSuper}isMegaTile(){return this.isMega}updateSuperEmitterPosition(){this.superEmitter&&(this.superEmitter.x=this.x,this.superEmitter.y=this.y+10)}goto(e){if(e.isNotTween)return this.x=e.x,this.y=e.y,void this.updateSuperEmitterPosition();c.numTweenRunning++;const t=this.scene.tweens.add({targets:this,x:e.x,y:e.y,delay:e.delay?e.delay:0,duration:e.duration?e.duration:500,ease:e.ease?e.ease:Phaser.Math.Easing.Linear,onComplete:()=>{c.numTweenRunning--,e.onComplete&&e.onComplete(),e.onCompleteAll&&0==c.numTweenRunning&&e.onCompleteAll(),t.destroy()},onUpdate:()=>{this.updateSuperEmitterPosition()}})}gotoGrid(e){const t=r.tileWidth/2+this.gridX*(r.tileWidth+r.margin)+(this.scene.cameras.main.width-(r.tileWidth+r.margin)*r.gridWidth),i=r.tileHeight/2+this.gridY*(r.tileHeight+r.margin)+100;this.goto({x:t,y:i,isNotTween:e.isNotTween,delay:e.delay,duration:e.duration,ease:e.ease,onComplete:e.onComplete,onCompleteAll:e.onCompleteAll})}setGrid(e,t,i){null==t&&(t=this.gridX),null==i&&(i=this.gridY),e.removeTile(this.gridX,this.gridY),this.gridX=t,this.gridY=i,e.setTile(this.gridX,this.gridY,this)}}c.numTweenRunning=0,c.boomFlag=0;class g{constructor(e){this.candyList=[],this.scene=e,this.tileMap=new Map,this.numCandy=12;for(let e=0;e<this.numCandy;e++)this.candyList.push(r.candyTypes[e]);this.shuffleCandyList();for(let e=0;e<r.gridHeight;e++)for(let t=0;t<r.gridWidth;t++)this.setTile(e,t,new c({scene:this.scene,x:this.scene.cameras.main.width/2,y:this.scene.cameras.main.height/2,texture:this.getRandomCandyKey()},e,t))}getTile(e,t){return this.tileMap.get(e.toString()+t.toString())}getTile2(e){return this.tileMap.get(e)}setTile(e,t,i){this.tileMap.set(e.toString()+t.toString(),i)}removeTile(e,t){this.tileMap.delete(e.toString()+t.toString())}shuffleCandyList(){}getRandomCandyKey(e,t){return e&&t&&Math.random()<.3?this.getSimilarCandyKey(e,t):this.candyList[Phaser.Math.Between(0,this.candyList.length-1)]}getSimilarCandyKey(e,t){const i=[];return this.getTile(e-1,t)&&i.push(this.getTile(e-1,t)),this.getTile(e+1,t)&&i.push(this.getTile(e+1,t)),this.getTile(e,t-1)&&i.push(this.getTile(e,t-1)),this.getTile(e,t+1)&&i.push(this.getTile(e,t+1)),i.length>0?i[Phaser.Math.Between(0,i.length-1)].getKey():this.getRandomCandyKey()}getTileMap(){return this.tileMap}swapTilesWithoutEffect(e,t,i,s){const r=this.getTile(e,t),n=this.getTile(i,s);r&&n?(this.setTile(e,t,n),this.setTile(i,s,r),r.gridX=i,r.gridY=s,n.gridX=e,n.gridY=t):console.log("Error swap!")}convertToKey(e,t){return e.toString()+t.toString()}handleMatch(e,t){this.scene.boardState=u.HANDLING;let i=1;const s=[0],n=new Map,a=[];a.push(this.getTile(0,0));const l=new Map,h=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}],o=[];for(;e.length>0;){const t=e.pop(),r=this.getTile(t.x,t.y);if(2==l.get(this.convertToKey(t.x,t.y)))continue;l.set(this.convertToKey(t.x,t.y),2);let d=n.get(this.convertToKey(t.x,t.y)),c=!1,g=!1;for(const e of h){const i=this.getTile(t.x+e.x,t.y+e.y);if(!i||i.getKey()!==r.getKey())continue;const s=this.getTile(t.x-e.x,t.y-e.y),n=this.getTile(t.x+2*e.x,t.y+2*e.y),a=s&&s.getKey()===r.getKey(),l=n&&n.getKey()===r.getKey();(a||l)&&(g=!0)}if(g){d||(d=i,s.push(1),a.push(r),i++,n.set(this.convertToKey(t.x,t.y),d));for(const i of h){const a=this.getTile(t.x+i.x,t.y+i.y);if(!a||a.getKey()!==r.getKey())continue;const h=this.getTile(t.x-i.x,t.y-i.y),o=this.getTile(t.x+2*i.x,t.y+2*i.y),g=h&&h.getKey()===r.getKey(),u=o&&o.getKey()===r.getKey();if(g||u){let r=n.get(this.convertToKey(t.x+i.x,t.y+i.y));r||(r=d,n.set(this.convertToKey(t.x+i.x,t.y+i.y),d),s[d]++),l.get(this.convertToKey(t.x+i.x,t.y+i.y))||(l.set(this.convertToKey(t.x+i.x,t.y+i.y),1),e.push({x:t.x+i.x,y:t.y+i.y})),c=!0}if(g){let r=n.get(this.convertToKey(t.x-i.x,t.y-i.y));r||(r=d,n.set(this.convertToKey(t.x-i.x,t.y-i.y),d),s[d]++),l.get(this.convertToKey(t.x-i.x,t.y-i.y))||(l.set(this.convertToKey(t.x-i.x,t.y-i.y),1),e.push({x:t.x-i.x,y:t.y-i.y}))}if(u){let r=n.get(this.convertToKey(t.x+2*i.x,t.y+2*i.y));r||(r=d,n.set(this.convertToKey(t.x+2*i.x,t.y+2*i.y),d),s[d]++),l.get(this.convertToKey(t.x+2*i.x,t.y+2*i.y))||(l.set(this.convertToKey(t.x+2*i.x,t.y+2*i.y),1),e.push({x:t.x+2*i.x,y:t.y+2*i.y}))}}c&&(r.isSuperTile()||r.isMegaTile())&&o.push({x:t.x,y:t.y})}}for(;o.length>0;){const e=o.pop(),t=this.getTile(e.x,e.y);if(t.isSuperTile()){for(let t=-1;t<=1;t++)for(let i=-1;i<=1;i++){const s=this.getTile(e.x+t,e.y+i);s&&(n.get(this.convertToKey(e.x+t,e.y+i))||(n.set(this.convertToKey(e.x+t,e.y+i),0),(s.isSuperTile()||s.isMegaTile())&&o.push({x:e.x+t,y:e.y+i})))}t.setSuper(!1)}else if(t.isMegaTile()){for(let t=0;t<=r.gridWidth;t++){let i=this.getTile(t,e.y);i&&(n.get(this.convertToKey(t,e.y))||(n.set(this.convertToKey(t,e.y),0),(i.isSuperTile()||i.isMegaTile())&&o.push({x:t,y:e.y}))),i=this.getTile(e.x,t),i&&(n.get(this.convertToKey(e.x,t))||(n.set(this.convertToKey(e.x,t),0),(i.isSuperTile()||i.isMegaTile())&&o.push({x:e.x,y:t})))}t.setMega(!1)}}this.handleMerge(n,s,a,t)}handleMerge(e,t,i,s){this.scene.boardState=u.MERGING;const n=[];for(let e=0;e<r.gridWidth;e++)n.push(3);let a=!1;for(const[r,l]of e){if(l>0&&t[l]<3)continue;const e=this.getIndexFromKey(r),h=this.getTile(e.x,e.y);if(!h){console.log("Error index tile!");continue}n[e.x]++;const o=-n[e.x],c=i[l];c.gridX==h.gridX&&c.gridY==h.gridY?this.scene.scoreBoard.emitterScoreEffect(c.x,c.y,(()=>{this.scene.scoreBoard.addScore(d.caculateScore(t[l]))})):0==l&&this.scene.scoreBoard.addScore(15),3!=t[l]&&0!=l?(a=!0,c.gridX!=h.gridX||c.gridY!=h.gridY?(h.boom(),h.goto({x:c.x,y:c.y,duration:300,ease:Phaser.Math.Easing.Linear,onComplete:()=>{h.setVisible(!1),h.setGrid(this,void 0,o),h.gotoGrid({isNotTween:!0})},onCompleteAll:()=>{this.handleFall(n,s)}})):(4==t[l]?c.isSuperTile()||c.setSuper():t[l]>=5&&(c.isMegaTile()||c.setMega()),n[e.x]--)):(h.boom(),h.setGrid(this,void 0,o),h.gotoGrid({isNotTween:!0}),h.setVisible(!1),this.scene.scoreBoard.addScore(10))}a||this.handleFall(n,s)}handleFall(e,t){c.boomFlag>10&&(c.bigBoom(),c.boomFlag=0),this.scene.boardState=u.FALLING;let i=!1;for(let t=0;t<e.length;t++)e[t]>3&&(i=!0);if(!i)return t&&t(!1),void(this.scene.boardState=u.IDLE);const s=[];for(let e=0;e<r.gridWidth;e++)s.push(-1);for(let i=0;i<r.gridWidth;i++){let n=0;for(let a=r.gridHeight-1;a>=-e[i];a--){const e=this.getTile(i,a);e?n>0&&(a<0&&e.setTexture(this.getRandomCandyKey()).setVisible(!0).setAngle(0),e.setGrid(this,void 0,a+n),e.gotoGrid({duration:100*n+200,delay:200,ease:Phaser.Math.Easing.Bounce.Out,onCompleteAll:()=>{t&&t();const e=[];for(let t=0;t<r.gridWidth;t++)for(let i=0;i<=s[t];i++)e.push({x:t,y:i});e.length>0?this.handleMatch(e,t):t&&t()}})):(0==n&&(s[i]=a),n++)}}}getIndexFromKey(e){switch(e.length){case 2:return{x:parseInt(e[0]),y:parseInt(e[1])};case 3:return"-"==e[0]?{x:parseInt(e[0]+e[1]),y:parseInt(e[2])}:{x:parseInt(e[0]),y:parseInt(e[1]+e[2])};default:return{x:parseInt(e[0]+e[1]),y:parseInt(e[2]+e[3])}}}}var u;!function(e){e.IDLE="Idle",e.CHOOSING="Choosing",e.SWAPPING="Swapping",e.HANDLING="Handling",e.FALLING="Falling",e.MERGING="Merging"}(u||(u={}));class T extends Phaser.Scene{constructor(){super({key:n.GAMEPLAY})}create(){this.add.image(0,0,"bg").setOrigin(0,0),a.init(this),this.tileManager=new g(this),this.shuffle(),this.scoreBoard=new d(this),this.input.on("gameobjectdown",this.onTileClicked,this)}update(e,t){switch(0==this.idleTime&&(this.isIdleTweenPlaying=!1),this.idleTime+=t,this.handleIdleTime(),this.boardState!=u.IDLE&&(this.idleTime=0),this.boardState){case u.IDLE:this.scoreBoard.handleGoToNextLevel(),this.resetSelect();break;case u.CHOOSING:case u.SWAPPING:this.firstSelectedTile&&this.firstSelectedTile.selectEffect(),this.secondSelectedTile&&this.secondSelectedTile.selectEffect();break;case u.HANDLING:case u.FALLING:case u.MERGING:this.resetSelect()}}onTileClicked(e,t){this.boardState!=u.IDLE&&this.boardState!=u.CHOOSING||(this.firstSelectedTile?this.secondSelectedTile||(this.secondSelectedTile=t,this.isValidSelect()?this.swapTiles((()=>{this.firstSelectedTile&&this.secondSelectedTile&&this.handleMatch(((e=!0)=>{this.resetSelect()}))})):this.resetSelect()):(this.boardState=u.CHOOSING,this.firstSelectedTile=t))}resetSelect(){this.firstSelectedTile&&this.firstSelectedTile.unSelectEffect(),this.secondSelectedTile&&this.secondSelectedTile.unSelectEffect(),this.firstSelectedTile=null,this.secondSelectedTile=null}isValidSelect(){return!0}swapTiles(e){if(this.boardState=u.SWAPPING,this.firstSelectedTile&&this.secondSelectedTile){const t=this.firstSelectedTile.x,i=this.firstSelectedTile.y,s=this.secondSelectedTile.x,r=this.secondSelectedTile.y,n=500;this.firstSelectedTile.goToPosition(s,r,void 0,void 0,n,(()=>{e()})),this.secondSelectedTile.goToPosition(t,i,void 0,void 0,n,(()=>{e()})),this.tileManager.swapTilesWithoutEffect(this.firstSelectedTile.gridX,this.firstSelectedTile.gridY,this.secondSelectedTile.gridX,this.secondSelectedTile.gridY)}}handleMatch(e){if(this.boardState==u.IDLE||this.boardState==u.SWAPPING)if(this.boardState=u.HANDLING,this.firstSelectedTile&&this.secondSelectedTile)this.tileManager.handleMatch([{x:this.secondSelectedTile.gridX,y:this.secondSelectedTile.gridY},{x:this.firstSelectedTile.gridX,y:this.firstSelectedTile.gridY}],((t=!0)=>{e&&e(t),this.boardState=u.IDLE}));else{const t=[];for(let e=0;e<r.gridWidth;e++)for(let i=0;i<r.gridHeight;i++)t.push({x:e,y:i});this.tileManager.handleMatch(t,((t=!0)=>{e&&e(t),this.boardState=u.IDLE}))}}idleEffect(){if(this.boardState==u.IDLE){for(let e=0;e<r.gridHeight;e++)for(let t=0;t<r.gridWidth;t++){const i=this.tileManager.getTile(e,t);if(!this.isIdleTweenPlaying){const s=this.tweens.add({targets:i,angle:360,delay:(e*r.gridHeight+t)/64*1e3,duration:1e3,ease:"Linear",onComplete:()=>{s.destroy()}})}}this.isIdleTweenPlaying=!0}}handleIdleTime(){this.idleTime>5e3&&this.boardState==u.IDLE?(this.firstSelectedTile&&(this.firstSelectedTile.unSelectEffect(),this.firstSelectedTile=null),this.idleEffect(),this.showHint()):this.hideHint()}handleHint(){const e=[];for(let t=0;t<r.gridHeight;t++)for(let i=0;i<r.gridWidth;i++){const s=this.tileManager.getTile(t,i),r=this.tileManager.getTile(t,i+1),n=this.tileManager.getTile(t,i+2);if(r){if(s.getKey()===r.getKey()){const r=[{T1:this.tileManager.getTile(t-1,i-1),T2:this.tileManager.getTile(t,i-1)},{T1:this.tileManager.getTile(t+1,i-1),T2:this.tileManager.getTile(t,i-1)},{T1:this.tileManager.getTile(t-1,i+2),T2:this.tileManager.getTile(t,i+2)},{T1:this.tileManager.getTile(t+1,i+2),T2:this.tileManager.getTile(t,i+2)},{T1:this.tileManager.getTile(t,i-2),T2:this.tileManager.getTile(t,i-1)},{T1:this.tileManager.getTile(t,i+3),T2:this.tileManager.getTile(t,i+2)}];for(let t=0;t<r.length;t++){const i=r[t].T1,n=r[t].T2;if(i&&n&&s.getKey()===i.getKey())return e.push(i),e.push(n),e}}if(n&&s.getKey()===n.getKey()){const r=[{T1:this.tileManager.getTile(t-1,i+1),T2:this.tileManager.getTile(t,i+1)},{T1:this.tileManager.getTile(t+1,i+1),T2:this.tileManager.getTile(t,i+1)}];for(let t=0;t<r.length;t++){const i=r[t].T1,n=r[t].T2;if(i&&n&&s.getKey()===i.getKey())return e.push(i),e.push(n),e}}}}for(let t=0;t<r.gridHeight;t++)for(let i=0;i<r.gridWidth;i++){const s=this.tileManager.getTile(t,i),r=this.tileManager.getTile(t+1,i),n=this.tileManager.getTile(t+2,i);if(r){if(s.getKey()===r.getKey()){const r=[{T1:this.tileManager.getTile(t-1,i-1),T2:this.tileManager.getTile(t-1,i)},{T1:this.tileManager.getTile(t-1,i+1),T2:this.tileManager.getTile(t-1,i)},{T1:this.tileManager.getTile(t+2,i-1),T2:this.tileManager.getTile(t+2,i)},{T1:this.tileManager.getTile(t+2,i+1),T2:this.tileManager.getTile(t+2,i)},{T1:this.tileManager.getTile(t-2,i),T2:this.tileManager.getTile(t-1,i)},{T1:this.tileManager.getTile(t+3,i),T2:this.tileManager.getTile(t+2,i)}];for(let t=0;t<r.length;t++){const i=r[t].T1,n=r[t].T2;if(i&&n&&s.getKey()===i.getKey())return e.push(i),e.push(n),e}}if(n&&s.getKey()===n.getKey()){const r=[{T1:this.tileManager.getTile(t+1,i-1),T2:this.tileManager.getTile(t+1,i)},{T1:this.tileManager.getTile(t+1,i+1),T2:this.tileManager.getTile(t+1,i)}];for(let t=0;t<r.length;t++){const i=r[t].T1,n=r[t].T2;if(i&&n&&s.getKey()===i.getKey())return e.push(i),e.push(n),e}}}}return e}showHint(){const e=this.handleHint();0!=e.length?(this.hintTile1=e[0],this.hintTile2=e[1],this.hintTile1&&this.hintTile2&&(this.hintTile1.showHint(),this.hintTile2.showHint())):this.shuffle()}hideHint(){this.hintTile1&&this.hintTile2&&(this.hintTile1.hideHint(),this.hintTile2.hideHint(),this.firstSelectedTile&&this.firstSelectedTile.showGraphics(),this.hintTile1=this.hintTile2=null)}shuffle(){this.boardState=u.HANDLING;const e=this.getRandomShape();this.tileManager.shuffleCandyList();for(let t=0;t<r.gridHeight;t++)for(let i=0;i<r.gridWidth;i++){const s=this.tileManager.getTile(t,i);s.setTexture(this.tileManager.getRandomCandyKey(s.gridX,s.gridY));const n={value:(t*r.gridHeight+i)/(r.gridHeight*r.gridWidth)},a=this.getPointFromShape(e,n.value);s.goToPosition(a.x,a.y,(()=>{const a=this.tweens.add({targets:n,value:(t*r.gridHeight+i)/(r.gridHeight*r.gridWidth)+1,duration:1e3,ease:"Linear",onComplete:()=>{var e;null===(e=this.tileManager.getTile(t,i))||void 0===e||e.updatePositon(!0,(()=>{this.tileManager.shuffleCandyList(),this.boardState=u.IDLE,this.handleMatch()}),Phaser.Math.Between(0,500)),a.destroy()},onUpdate:()=>{let t=n.value;t>1&&(t-=1);const i=this.getPointFromShape(e,t);s.x=i.x,s.y=i.y,s.updateSuperEmitterPosition()}})}))}}getRandomShape(){const e=Phaser.Math.Between(0,5),t=this.cameras.main.width/2,i=this.cameras.main.height/2;switch(e){case 0:return new Phaser.Geom.Rectangle(t-150,i-150,300,300);case 1:return new Phaser.Geom.Circle(t,i,200);case 2:return new Phaser.Geom.Ellipse(t,i,300,200);case 3:return new Phaser.Geom.Ellipse(t,i,200,300);case 4:return new Phaser.Geom.Triangle(t,i-200,t-200,i+200,t+200,i+200);default:return new Phaser.Geom.Rectangle(t-200,i-100,400,200)}}getPointFromShape(e,t){return e instanceof Phaser.Geom.Rectangle?Phaser.Geom.Rectangle.GetPoint(e,t):e instanceof Phaser.Geom.Circle?Phaser.Geom.Circle.GetPoint(e,t):e instanceof Phaser.Geom.Ellipse?Phaser.Geom.Ellipse.GetPoint(e,t):Phaser.Geom.Triangle.GetPoint(e,t)}}class p extends Phaser.Scene{constructor(){super({key:n.LOADING})}preload(){this.cameras.main.setBackgroundColor(10016391),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start(n.MENU)}}class y extends Phaser.Scene{constructor(){super({key:n.MENU})}preload(){this.load.atlas("confetti","assets\\confeti\\confetti.png","assets\\confeti\\confetti.json")}create(){this.add.image(0,0,"bg").setOrigin(0,0),this.add.image(470,200,r.candyTypes[0]),this.add.image(440,210,r.candyTypes[1]),this.add.image(430,180,r.candyTypes[4]),this.add.image(180,170,r.candyTypes[3]),this.add.image(300,220,r.candyTypes[2]),this.add.text(this.cameras.main.width/2,200,"CANDY CRUSH",{fontFamily:"Cambria",fontSize:60,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:4}).setDepth(4).setOrigin(.5,.5).setAlign("center");const e=this.add.rectangle(this.cameras.main.width/2,325,150,50,11622).setStrokeStyle(3,15546518).setInteractive().setName("PlayBtn");e.on("pointerover",(()=>{e.fillColor=2142890})),e.on("pointerout",(()=>{e.fillColor=11622})),this.add.text(this.cameras.main.width/2,325,"PLAY",{fontFamily:"Cambria",fontSize:30,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(4).setOrigin(.5,.5);const t=this.add.rectangle(this.cameras.main.width/2,400,150,50,11622).setStrokeStyle(3,15546518).setInteractive().setName("SettingBtn");t.on("pointerover",(()=>{t.fillColor=2142890})),t.on("pointerout",(()=>{t.fillColor=11622})),this.add.text(this.cameras.main.width/2,400,"SETTING",{fontFamily:"Cambria",fontSize:30,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(4).setOrigin(.5,.5);const i=this.add.rectangle(this.cameras.main.width/2,475,150,50,11622).setStrokeStyle(3,15546518).setInteractive().setName("SettingBtn");i.on("pointerover",(()=>{i.fillColor=2142890})),i.on("pointerout",(()=>{i.fillColor=11622})),this.add.text(this.cameras.main.width/2,475,"EXIT",{fontFamily:"Cambria",fontSize:30,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(4).setOrigin(.5,.5),this.input.on("gameobjectdown",((e,t)=>{("PlayBtn"==t.name||"SettingBtn"==t.name)&&this.scene.start(n.GAMEPLAY)}),this)}}const f={title:"Candy Rush",url:"https://github.com/leanhhuy0709/candy-rush",version:"2.0",type:Phaser.AUTO,parent:"Game",scene:[p,y,T],input:{keyboard:!0},scale:{mode:Phaser.Scale.ScaleModes.FIT,autoCenter:Phaser.Scale.Center.CENTER_BOTH,resizeInterval:1},width:600,height:800,backgroundColor:"#000000"};class m extends s.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new m(f)}))}},i={};function s(e){var r=i[e];if(void 0!==r)return r.exports;var n=i[e]={exports:{}};return t[e].call(n.exports,n,n.exports,s),n.exports}s.m=t,e=[],s.O=(t,i,r,n)=>{if(!i){var a=1/0;for(d=0;d<e.length;d++){for(var[i,r,n]=e[d],l=!0,h=0;h<i.length;h++)(!1&n||a>=n)&&Object.keys(s.O).every((e=>s.O[e](i[h])))?i.splice(h--,1):(l=!1,n<a&&(a=n));if(l){e.splice(d--,1);var o=r();void 0!==o&&(t=o)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[i,r,n]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var r,n,[a,l,h]=i,o=0;if(a.some((t=>0!==e[t]))){for(r in l)s.o(l,r)&&(s.m[r]=l[r]);if(h)var d=h(s)}for(t&&t(i);o<a.length;o++)n=a[o],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var r=s.O(void 0,[216],(()=>s(476)));r=s.O(r)})();