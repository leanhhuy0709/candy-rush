(()=>{"use strict";var e,t={476:(e,t,i)=>{var s=i(260);const r={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:72,margin:10,candyTypes:["cookie1","cookie2","croissant","cupcake","donut","eclair","macaroon","pie","poptart1","poptart2","starcookie1","starcookie2"]};var a;!function(e){e.LOADING="LoadingScene",e.GAMEPLAY="GamePlayScene",e.MENU="MenuScene"}(a||(a={}));class n{static init(e){this.scene=e}static getParticleEmitter(e,t,i,s){return this.scene.add.particles(e,t,i,s)}static removeParticleEmitter(e){e.destroy()}}n.particleEmitterList=[];const l=30,h=175;class o extends Phaser.GameObjects.Particles.Particle{constructor(e){super(e),this.isInit=!1}update(e,t,i){const s=this.x,r=this.y,a=super.update(e,t,i),n=this.lifeCurrent/this.life,l=Phaser.Math.Easing.Quartic.In(n);return this.x=s+e*this.velocityX/1e3*l,this.y=r+e*this.velocityY/1e3*l,this.angle+=e/1e3*20,a}}class d{constructor(e){this.level=1,this.levels=[],this.scene=e,this.score=0,this.scoreText=e.add.text(e.cameras.main.width/2,50,"0",{fontFamily:"Cambria",fontSize:55,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(6).setOrigin(.5,.5);for(let e=1;e<1e3;e++)this.levels.push(e*(e+1)/2*500);this.progressBarEmitter=n.getParticleEmitter(l,60,"flares",{frame:"white",color:[9887962,9666291],colorEase:"quad.out",lifespan:500,angle:{min:-190,max:-170},scale:{start:.2,end:0,ease:"sine.out"},speed:100,advance:2e3,blendMode:"ADD"}).setDepth(6).start(void 0,-1),this.scene.add.graphics().lineStyle(3,15546518).setDepth(9).strokeRoundedRect(l,50,h,20,5).fillStyle(11622).fillRoundedRect(l,50,h,20,5).setDepth(4),this.progressBar=this.scene.add.graphics().fillStyle(16110006).fillRoundedRect(l,50,h,20,5).setDepth(5),this.updateProgressBar(0),this.targetText=e.add.text(117.5,30,`${this.levels[this.level]}`,{fontFamily:"Cambria",fontSize:20,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(6).setOrigin(.5,.5),this.confettiEmitter=this.scene.add.particles(0,300,"confetti",{frame:["1","2","3","4","5"],lifespan:3500,scale:{start:.3,end:.5},alpha:{start:75,end:100},angle:{min:-180,max:180},speedX:{min:300,max:800},speedY:{min:-1e3,max:-500},gravityY:1800,quantity:1,particleClass:o}).setDepth(7).stop()}addScore(e){this.score+=e,this.scoreText.setText(this.score.toString()),this.updateProgressBar((this.score-this.levels[this.level-1])/(this.levels[this.level]-this.levels[this.level-1]))}updateProgressBar(e){e<=.05&&(e=.05),e>1&&(e=1),this.progressBar.clear(),this.progressBar.fillStyle(16110006).fillRoundedRect(l,50,e*h,20,5).setDepth(5),this.progressBarEmitter.setPosition(l+e*h-5,60),e>=.1?this.progressBarEmitter.setVisible(!0):this.progressBarEmitter.setVisible(!1)}handleGoToNextLevel(){for(;this.score>=this.levels[this.level];)this.level++,this.targetText.setText(`${this.levels[this.level]}`),this.updateProgressBar((this.score-this.levels[this.level-1])/(this.levels[this.level]-this.levels[this.level-1])),this.scene.shuffle(),this.confettiEmitter.start(void 0,1e3)}emitterScoreEffect(e,t,i){const s=this.scene.add.image(e,t,"").setVisible(!1),r=n.getParticleEmitter(0,0,"flares",{frame:{frames:["red","green","blue","yellow"],cycle:!0},blendMode:Phaser.BlendModes.ADD,follow:s,speed:100,gravityY:300,lifespan:1e3,quantity:1,scale:{start:.3,end:.1}}).setDepth(6).start(void 0,1e3);let a=(this.score-this.levels[this.level-1])/(this.levels[this.level]-this.levels[this.level-1]);a<=.05&&(a=.05),a>1&&(a=1);const o=this.scene.tweens.add({targets:s,x:l+a*h,y:70,duration:1e3,onComplete:()=>{s.destroy(),n.removeParticleEmitter(r),o.destroy(),i&&i()}})}}class c extends Phaser.GameObjects.Image{constructor(e,t,i){super(e.scene,e.x,e.y,e.texture,e.frame),this.isSuper=!1,this.isMega=!1,this.setOrigin(.5,.5).setInteractive().setDepth(5),this.gridX=t,this.gridY=i,this.graphics=this.scene.add.graphics().lineStyle(2,12183295).setVisible(!1).setDepth(4),this.graphics.strokeRoundedRect(0,0,this.width+2,this.height),this.setGraphics(),this.scene.add.existing(this),this.tween=this.scene.tweens.add({targets:this,angle:360,duration:1500,ease:"Linear",repeat:-1}),this.tween.pause(),this.hintTween=this.scene.tweens.add({targets:this,scale:.8,duration:500,ease:"Linear",repeat:-1,yoyo:!0}),this.hintTween.pause()}spin(){this.tween.resume()}unSpin(){this.tween.pause();const e=this.scene.tweens.add({targets:this,angle:0,duration:800,ease:"Linear",onComplete:()=>e.destroy()})}showGraphics(){this.setGraphics(),this.graphics.setVisible(!0)}hideGraphics(){this.graphics.setVisible(!1)}setGraphics(){const e=this.width+2,t=this.height;this.graphics.x=this.x-e/2,this.graphics.y=this.y-t/2}getKey(){return this.texture.key}selectEffect(){this.spin(),this.showGraphics()}unSelectEffect(){this.unSpin(),this.hideGraphics()}updatePositon(e=!0,t,i,s,a){const n=this.scene.cameras.main.width;let l=500;s&&(l=s),i||(i=0);const h=r.tileWidth/2+this.gridX*(r.tileWidth+r.margin)+(n-(r.tileWidth+r.margin)*r.gridWidth),o=r.tileHeight/2+this.gridY*(r.tileHeight+r.margin)+100;if(e){c.numTweenRunning++;const e=this.scene.tweens.add({targets:this,x:h,y:o,delay:i,duration:l,ease:Phaser.Math.Easing.Bounce.Out,onComplete:()=>{a&&a(),c.numTweenRunning--,t&&0==c.numTweenRunning&&t(),e.destroy()}});if(this.superEmitter){const e=this.scene.tweens.add({targets:this.superEmitter,x:h,y:o+10,delay:i,duration:l,ease:Phaser.Math.Easing.Bounce.Out,onComplete:()=>e.destroy()})}}else this.x=h,this.y=o}goToPosition(e,t,i,s,r,a){c.numTweenRunning++;const n=this.scene.tweens.add({targets:this,x:e,y:t,delay:s,duration:500,ease:"Power2",onComplete:()=>{c.numTweenRunning--,i&&i(),a&&0==c.numTweenRunning&&a(),n.destroy()}});if(this.superEmitter){const i=this.scene.tweens.add({targets:this.superEmitter,x:e,y:t+10,delay:s,duration:500,ease:Phaser.Math.Easing.Bounce.Out,onComplete:()=>i.destroy()})}}showHint(){this.hintTween.resume(),this.showGraphics()}hideHint(){this.hintTween.pause(),this.scene.tweens.add({targets:this,scale:1,duration:1e3,ease:"Linear"}),this.hideGraphics()}boom(){if(!(c.boomFlag>10))if(c.boomFlag++,this.isSuperTile()||this.isMegaTile()){const e=n.getParticleEmitter(this.x,this.y,"flares",{frame:["red"],lifespan:400,speed:{min:150,max:250},scale:{start:.3,end:0},gravityY:150,blendMode:"ADD",emitting:!1}).setDepth(6).start(void 0,1e3);e.explode(16),setTimeout((()=>{n.removeParticleEmitter(e)}),500)}else{const e=n.getParticleEmitter(this.x,this.y,"flares",{frame:[],lifespan:400,speed:{min:150,max:250},scale:{start:.3,end:0},gravityY:150,blendMode:"ADD",emitting:!1}).setDepth(6).start(void 0,1e3);e.explode(16),setTimeout((()=>{n.removeParticleEmitter(e)}),500)}}setSuper(e=!0){this.isSuper=e,this.superEmitter&&(n.removeParticleEmitter(this.superEmitter),this.superEmitter=null),e&&(this.superEmitter=n.getParticleEmitter(this.x,this.y+20,"flares",{frame:"blue",color:[61696],colorEase:"quart.out",lifespan:500,angle:{min:-100,max:-80},scale:{start:.75,end:0,ease:"sine.out"},speed:{min:200,max:300},advance:2e3,blendMode:"ADD"}).setDepth(3).start(void 0,1e3))}setMega(e=!0){this.isMega=e,this.superEmitter&&(n.removeParticleEmitter(this.superEmitter),this.superEmitter=null),e&&(this.superEmitter=n.getParticleEmitter(this.x,this.y+20,"flares",{frame:["red"],color:[16711680],lifespan:500,angle:{min:-100,max:-80},scale:{start:.75,end:0,ease:"sine.out"},speed:{min:200,max:300},advance:2e3,blendMode:"ADD"}).setDepth(3).start(void 0,1e3))}isSuperTile(){return this.isSuper}isMegaTile(){return this.isMega}updateSuperEmitterPosition(){this.superEmitter&&(this.superEmitter.x=this.x,this.superEmitter.y=this.y+10)}}c.numTweenRunning=0,c.boomFlag=0;const g=["#ffffff","#bcffe3","#20b2aa","#ffd966"];class f{constructor(e){this.candyList=[],this.scene=e,this.tileMap=new Map,this.numCandy=5;for(let e=0;e<this.numCandy;e++)this.candyList.push(r.candyTypes[e]);this.shuffleCandyList();for(let e=0;e<r.gridHeight;e++)for(let t=0;t<r.gridWidth;t++)this.setTile(e,t,new c({scene:this.scene,x:this.scene.cameras.main.width/2,y:this.scene.cameras.main.height/2,texture:this.getRandomCandyKey()},e,t))}getTile(e,t){return this.tileMap.get(e.toString()+t.toString())}setTile(e,t,i){this.tileMap.set(e.toString()+t.toString(),i)}removeTile(e,t){this.tileMap.delete(e.toString()+t.toString())}shuffleCandyList(){}getRandomCandyKey(e,t){return e&&t&&Math.random()<.3?this.getSimilarCandyKey(e,t):this.candyList[Phaser.Math.Between(0,this.candyList.length-1)]}getSimilarCandyKey(e,t){const i=[];return this.getTile(e-1,t)&&i.push(this.getTile(e-1,t)),this.getTile(e+1,t)&&i.push(this.getTile(e+1,t)),this.getTile(e,t-1)&&i.push(this.getTile(e,t-1)),this.getTile(e,t+1)&&i.push(this.getTile(e,t+1)),i.length>0?i[Phaser.Math.Between(0,i.length-1)].getKey():this.getRandomCandyKey()}getTileMap(){return this.tileMap}swapTilesWithoutEffect(e,t,i,s){const r=this.getTile(e,t),a=this.getTile(i,s);r&&a?(this.setTile(e,t,a),this.setTile(i,s,r),r.gridX=i,r.gridY=s,a.gridX=e,a.gridY=t):console.log("Error swap!")}convertToKey(e,t){return e.toString()+t.toString()}handleMatch(e,t=1){c.boomFlag=0;const i=this.traverse(t),s=i.cols,r=i.listBoom,a=i.group,l=i.listGroup,h=i.groupZeroBoom;for(;h.length>0;){const e=h.pop();if(0!=a.get(this.convertToKey(e.x,e.y)))continue;e.x<0&&console.log(e.x);const i=this.getTile(e.x,e.y);i&&(s[e.x]++,i.boom(),r.push({x:e.x,y:e.y,newY:-s[e.x]}),this.addTileBoomBySuperMegaToGroup(i,e.x,e.y,a,h,t))}const o=[];for(let e=0;e<l.length;e++)o.push({x:0,y:0});const d=[];for(let e=0;e<l.length;e++)d.push([]);for(let e=0;e<r.length;e++){const t=r[e],i=this.getTile(t.x,t.y);if(i){const e=a.get(this.convertToKey(t.x,t.y));e&&(o[e].x+=i.x,o[e].y+=i.y+10,d[e].push({x:i.gridX,y:i.gridY,tile:i})),this.removeTile(t.x,t.y),i.gridY=t.newY,this.setTile(t.x,t.newY,i),i.updatePositon(!1),i.angle=0}}if(c.boomFlag>10){const e=n.getParticleEmitter(this.scene.cameras.main.width/2,this.scene.cameras.main.height/2,"flares",{frame:["red","blue","green"],lifespan:4e3,speed:{min:300,max:500},scale:1,gravityY:150,blendMode:"ADD",emitting:!1}).setDepth(6);e.explode(50),setTimeout((()=>{n.removeParticleEmitter(e)}),2e3),c.boomFlag=0}const f=[];let T="";for(let e=1;e<l.length;e++){let i=0;switch(l[e]){case 0:case 1:case 2:console.log("Error Group");break;case 3:i=30,T=g[0];break;case 4:i=60,T=g[0];break;case 5:i=100,T=g[0];break;case 6:i=200,T=g[1];break;case 7:i=400,T=g[1];break;case 8:i=700,T=g[2];break;case 9:i=1e3,T=g[2];break;default:i=40*l[e]+1e3,T=g[3]}let r=t-1;r>=g.length&&(r=g.length-1),i*=r+1;let a=-2,n=-2;const h=new Map,c=new Map;for(let t=0;t<d[e].length;t++){const i=d[e][t];h.has(i.x)||h.set(i.x,0),c.has(i.y)||c.set(i.y,0),h.set(i.x,h.get(i.x)+1),c.set(i.y,c.get(i.y)+1)}let p=-1,u=-1;for(const[e,t]of h)p<t&&(p=t,a=e);for(const[e,t]of c)u<t&&(u=t,n=e);let y=0;for(;y<d[e].length;y++){const t=d[e][y];if(t.x==a&&t.y==n)break}if(y==d[e].length){let t=0;for(;t<d[e].length;t++){const i=d[e][t];if(i.x==a){n=i.y;break}}}if(l[e]>=4){const t=this.getTile(a,-s[a]);t?(t.setTexture(d[e][0].tile.getKey()),s[t.gridX]--,this.removeTile(t.gridX,t.gridY),t.gridX=a,t.gridY=n,this.setTile(t.gridX,t.gridY,t),t.updatePositon(!1),f.push({groupIdx:e,tile:t}),4==l[e]?t.setSuper():t.setMega()):console.log("Error Tile!",a)}this.scene.scoreBoard.emitterScoreEffect(o[e].x/l[e],o[e].y/l[e],(()=>this.scene.scoreBoard.addScore(i)));const m=this.scene.add.text(o[e].x/l[e],o[e].y/l[e],i.toString(),{fontFamily:"Cambria",fontSize:25+(i<=1e4?i:1e4)/1e4*15,color:T}).setDepth(6).setOrigin(.5,.5).setAlpha(0).setStroke("#000000",2),S=this.scene.tweens.add({targets:m,alpha:1,duration:700,y:o[e].y/l[e]-10,onComplete:()=>{m.destroy(),S.destroy()}})}this.scene.boardState=p.MERGING;for(const[e,t]of this.getTileMap())t.gridY<0&&t.setVisible(!1);let u=0;for(let e=0;e<f.length;e++)u+=d[f[e].groupIdx].length;if(0!=u)for(let i=0;i<f.length;i++){const a=f[i].tile,n=f[i].groupIdx;for(let i=0;i<d[n].length;i++){const o=d[n][i],g=new c({scene:this.scene,x:this.scene.cameras.main.width/2,y:this.scene.cameras.main.height/2,texture:a.getKey()},o.x,o.y);g.updatePositon(!1),g.gridX=a.gridX,g.gridY=a.gridY,g.updatePositon(!0,void 0,void 0,500,(()=>{g.destroy(),u--,0==u&&this.handleFall(r,h,l,s,t+1,e)}))}}else this.handleFall(r,h,l,s,t,e)}handleFall(e,t,i,s,a,n){if(this.scene.boardState=p.FALLING,e.length)for(let e=0;e<r.gridWidth;e++){let t=0;for(let l=r.gridHeight-1;l>=-s[e];l--){const r=this.getTile(e,l);r?t>0&&(l<0&&(r.setTexture(this.getRandomCandyKey(r.gridX,r.gridY)),r.setVisible(!0)),this.removeTile(e,l),r.gridY=l+t,this.setTile(e,l+t,r),r.updatePositon(!0,(()=>{this.handleMatch((()=>{n&&n()}),a+i.length-1)}),void 0,187.5*s[e])):t++}}else n&&n(!1)}addTileBoomBySuperMegaToGroup(e,t,i,s,a,n=1){if(e.isSuperTile()){for(let e=-1;e<=1;e++)for(let r=-1;r<=1;r++)!s.has(this.convertToKey(t+e,i+r))&&this.getTile(t+e,i+r)&&(s.set(this.convertToKey(t+e,i+r),0),a.push({x:t+e,y:i+r}));this.scene.scoreBoard.emitterScoreEffect(e.x,e.y,(()=>this.scene.scoreBoard.addScore(250*(n<4?n:4))));const r=this.scene.add.text(e.x,e.y+10,(250*(n<4?n:4)).toString(),{fontFamily:"Cambria",fontSize:32,color:g[1]}).setDepth(6).setOrigin(.5,.5).setAlpha(0).setStroke("#000000",2),l=this.scene.tweens.add({targets:r,alpha:1,duration:700,y:e.y,onComplete:()=>{r.destroy(),l.destroy()}});e.setSuper(!1)}else if(e.isMegaTile()){for(let e=0;e<=r.gridWidth;e++)!s.has(this.convertToKey(e,i))&&this.getTile(e,i)&&(s.set(this.convertToKey(e,i),0),a.push({x:e,y:i}));for(let e=0;e<=r.gridHeight;e++)!s.has(this.convertToKey(t,e))&&this.getTile(t,e)&&(s.set(this.convertToKey(t,e),0),a.push({x:t,y:e}));this.scene.scoreBoard.emitterScoreEffect(e.x,e.y,(()=>this.scene.scoreBoard.addScore(800*(n<4?n:4))));const l=this.scene.add.text(e.x,e.y+10,(800*(n<4?n:4)).toString(),{fontFamily:"Cambria",fontSize:32,color:g[1]}).setDepth(6).setOrigin(.5,.5).setAlpha(0).setStroke("#000000",2),h=this.scene.tweens.add({targets:l,alpha:1,duration:700,y:e.y,onComplete:()=>{l.destroy(),h.destroy()}});e.setMega(!1)}}traverse(e){const t=[];for(let e=0;e<r.gridWidth;e++)t.push(0);const i=[],s=new Map;let a=1;const n=[0],l=[],h=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}];for(let o=0;o<r.gridHeight;o++)for(let d=0;d<r.gridWidth;d++){const r=this.getTile(o,d);r||console.log("Error index tile!");let c=s.get(this.convertToKey(o,d)),g=!1;if(null==c){for(let e=0;e<h.length;e++){const t=this.getTile(o+h[e].x,d+h[e].y),i=this.getTile(o-h[e].x,d-h[e].y),a=this.getTile(o+2*h[e].x,d+2*h[e].y),n=t&&t.getKey()===r.getKey(),l=i&&i.getKey()===r.getKey(),g=a&&a.getKey()===r.getKey();if(n){if(l){const t=s.get(this.convertToKey(o-h[e].x,d-h[e].y));if(t){c=t;break}}if(g){const t=s.get(this.convertToKey(o+2*h[e].x,d+2*h[e].y));if(t){c=t;break}}}}c&&s.set(this.convertToKey(o,d),c)}for(let f=0;f<h.length;f++){const p=this.getTile(o+h[f].x,d+h[f].y),T=this.getTile(o-h[f].x,d-h[f].y),u=this.getTile(o+2*h[f].x,d+2*h[f].y),y=p&&p.getKey()===r.getKey(),m=T&&T.getKey()===r.getKey(),S=u&&u.getKey()===r.getKey();if(!y)continue;let x,v=s.get(this.convertToKey(o+h[f].x,d+h[f].y));c&&(x=c),v&&(x=v),(m||S)&&(g||(t[r.gridX]++,r.boom(),i.push({x:o,y:d,newY:-t[r.gridX]})),null==x&&(x=a,n.push(0),a++),c!=x&&(c=x,s.set(this.convertToKey(o,d),x),n[x]++),v!=x&&(v=x,s.set(this.convertToKey(o+h[f].x,d+h[f].y),x),n[x]++),m&&s.get(this.convertToKey(o-h[f].x,d-h[f].y))!=x&&(s.set(this.convertToKey(o-h[f].x,d-h[f].y),x),n[x]++),S&&s.get(this.convertToKey(o+2*h[f].x,d+2*h[f].y))!=x&&(s.set(this.convertToKey(o+2*h[f].x,d+2*h[f].y),x),n[x]++),g=!0,this.addTileBoomBySuperMegaToGroup(r,o,d,s,l,e))}}return{cols:t,listBoom:i,group:s,listGroup:n,groupZeroBoom:l}}}var p;!function(e){e.IDLE="Idle",e.CHOOSING="Choosing",e.SWAPPING="Swapping",e.HANDLING="Handling",e.FALLING="Falling",e.MERGING="Merging"}(p||(p={}));class T extends Phaser.Scene{constructor(){super({key:a.GAMEPLAY})}create(){this.add.image(0,0,"bg").setOrigin(0,0),n.init(this),this.tileManager=new f(this),this.boardState=p.HANDLING,this.shuffle(),this.scoreBoard=new d(this),this.input.on("gameobjectdown",this.onTileClicked,this)}update(e,t){switch(0==this.idleTime&&(this.isIdleTweenPlaying=!1),this.idleTime+=t,this.handleIdleTime(),this.boardState!=p.IDLE&&(this.idleTime=0),this.boardState){case p.IDLE:this.scoreBoard.handleGoToNextLevel(),this.resetSelect();break;case p.CHOOSING:case p.SWAPPING:this.firstSelectedTile&&this.firstSelectedTile.selectEffect(),this.secondSelectedTile&&this.secondSelectedTile.selectEffect();break;case p.HANDLING:case p.FALLING:case p.MERGING:this.resetSelect()}}onTileClicked(e,t){this.boardState!=p.IDLE&&this.boardState!=p.CHOOSING||(this.firstSelectedTile?this.secondSelectedTile||(this.secondSelectedTile=t,this.isValidSelect()?this.swapTiles((()=>{this.firstSelectedTile&&this.secondSelectedTile&&this.handleMatch(((e=!0)=>{e?this.resetSelect():this.swapTiles((()=>{this.resetSelect()}))}))})):this.resetSelect()):(this.boardState=p.CHOOSING,this.firstSelectedTile=t))}resetSelect(){this.firstSelectedTile&&this.firstSelectedTile.unSelectEffect(),this.secondSelectedTile&&this.secondSelectedTile.unSelectEffect(),this.firstSelectedTile=null,this.secondSelectedTile=null}isValidSelect(){if(this.firstSelectedTile&&this.secondSelectedTile){const e=this.firstSelectedTile.gridX,t=this.firstSelectedTile.gridY,i=this.secondSelectedTile.gridX,s=this.secondSelectedTile.gridY;return Math.abs(e-i)+Math.abs(t-s)===1}return!1}swapTiles(e){if(this.boardState=p.SWAPPING,this.firstSelectedTile&&this.secondSelectedTile){const t=this.firstSelectedTile.x,i=this.firstSelectedTile.y,s=this.secondSelectedTile.x,r=this.secondSelectedTile.y,a=500;this.firstSelectedTile.goToPosition(s,r,void 0,void 0,a,(()=>{this.firstSelectedTile&&this.secondSelectedTile&&this.tileManager.swapTilesWithoutEffect(this.firstSelectedTile.gridX,this.firstSelectedTile.gridY,this.secondSelectedTile.gridX,this.secondSelectedTile.gridY),e()})),this.secondSelectedTile.goToPosition(t,i,void 0,void 0,a,(()=>{this.firstSelectedTile&&this.secondSelectedTile&&this.tileManager.swapTilesWithoutEffect(this.firstSelectedTile.gridX,this.firstSelectedTile.gridY,this.secondSelectedTile.gridX,this.secondSelectedTile.gridY),e()}))}}handleMatch(e){this.boardState!=p.IDLE&&this.boardState!=p.SWAPPING||(this.boardState=p.HANDLING,this.tileManager.handleMatch(((t=!0)=>{e&&e(t),this.boardState=p.IDLE})))}idleEffect(){if(this.boardState==p.IDLE){for(let e=0;e<r.gridHeight;e++)for(let t=0;t<r.gridWidth;t++){const i=this.tileManager.getTile(e,t);if(!this.isIdleTweenPlaying){const s=this.tweens.add({targets:i,angle:360,delay:(e*r.gridHeight+t)/64*1e3,duration:1e3,ease:"Linear",onComplete:()=>{s.destroy()}})}}this.isIdleTweenPlaying=!0}}handleIdleTime(){this.idleTime>5e3&&this.boardState==p.IDLE?(this.firstSelectedTile&&(this.firstSelectedTile.unSelectEffect(),this.firstSelectedTile=null),this.idleEffect(),this.showHint()):this.hideHint()}handleHint(){const e=[];for(let t=0;t<r.gridHeight;t++)for(let i=0;i<r.gridWidth;i++){const s=this.tileManager.getTile(t,i),r=this.tileManager.getTile(t,i+1),a=this.tileManager.getTile(t,i+2);if(r){if(s.getKey()===r.getKey()){const r=[{T1:this.tileManager.getTile(t-1,i-1),T2:this.tileManager.getTile(t,i-1)},{T1:this.tileManager.getTile(t+1,i-1),T2:this.tileManager.getTile(t,i-1)},{T1:this.tileManager.getTile(t-1,i+2),T2:this.tileManager.getTile(t,i+2)},{T1:this.tileManager.getTile(t+1,i+2),T2:this.tileManager.getTile(t,i+2)},{T1:this.tileManager.getTile(t,i-2),T2:this.tileManager.getTile(t,i-1)},{T1:this.tileManager.getTile(t,i+3),T2:this.tileManager.getTile(t,i+2)}];for(let t=0;t<r.length;t++){const i=r[t].T1,a=r[t].T2;if(i&&a&&s.getKey()===i.getKey())return e.push(i),e.push(a),e}}if(a&&s.getKey()===a.getKey()){const r=[{T1:this.tileManager.getTile(t-1,i+1),T2:this.tileManager.getTile(t,i+1)},{T1:this.tileManager.getTile(t+1,i+1),T2:this.tileManager.getTile(t,i+1)}];for(let t=0;t<r.length;t++){const i=r[t].T1,a=r[t].T2;if(i&&a&&s.getKey()===i.getKey())return e.push(i),e.push(a),e}}}}for(let t=0;t<r.gridHeight;t++)for(let i=0;i<r.gridWidth;i++){const s=this.tileManager.getTile(t,i),r=this.tileManager.getTile(t+1,i),a=this.tileManager.getTile(t+2,i);if(r){if(s.getKey()===r.getKey()){const r=[{T1:this.tileManager.getTile(t-1,i-1),T2:this.tileManager.getTile(t-1,i)},{T1:this.tileManager.getTile(t-1,i+1),T2:this.tileManager.getTile(t-1,i)},{T1:this.tileManager.getTile(t+2,i-1),T2:this.tileManager.getTile(t+2,i)},{T1:this.tileManager.getTile(t+2,i+1),T2:this.tileManager.getTile(t+2,i)},{T1:this.tileManager.getTile(t-2,i),T2:this.tileManager.getTile(t-1,i)},{T1:this.tileManager.getTile(t+3,i),T2:this.tileManager.getTile(t+2,i)}];for(let t=0;t<r.length;t++){const i=r[t].T1,a=r[t].T2;if(i&&a&&s.getKey()===i.getKey())return e.push(i),e.push(a),e}}if(a&&s.getKey()===a.getKey()){const r=[{T1:this.tileManager.getTile(t+1,i-1),T2:this.tileManager.getTile(t+1,i)},{T1:this.tileManager.getTile(t+1,i+1),T2:this.tileManager.getTile(t+1,i)}];for(let t=0;t<r.length;t++){const i=r[t].T1,a=r[t].T2;if(i&&a&&s.getKey()===i.getKey())return e.push(i),e.push(a),e}}}}return e}showHint(){const e=this.handleHint();0!=e.length?(this.hintTile1=e[0],this.hintTile2=e[1],this.hintTile1&&this.hintTile2&&(this.hintTile1.showHint(),this.hintTile2.showHint())):this.shuffle()}hideHint(){this.hintTile1&&this.hintTile2&&(this.hintTile1.hideHint(),this.hintTile2.hideHint(),this.firstSelectedTile&&this.firstSelectedTile.showGraphics(),this.hintTile1=this.hintTile2=null)}shuffle(){this.boardState=p.HANDLING,this.idleTime=0;const e=this.getRandomShape();this.tileManager.shuffleCandyList();for(let t=0;t<r.gridHeight;t++)for(let i=0;i<r.gridWidth;i++){const s=this.tileManager.getTile(t,i);s.setTexture(this.tileManager.getRandomCandyKey(s.gridX,s.gridY));const a={value:(t*r.gridHeight+i)/(r.gridHeight*r.gridWidth)},n=this.getPointFromShape(e,a.value);s.goToPosition(n.x,n.y,(()=>{const n=this.tweens.add({targets:a,value:(t*r.gridHeight+i)/(r.gridHeight*r.gridWidth)+1,duration:1e3,ease:"Linear",onComplete:()=>{var e;null===(e=this.tileManager.getTile(t,i))||void 0===e||e.updatePositon(!0,(()=>{this.tileManager.shuffleCandyList(),this.boardState=p.IDLE,this.handleMatch()}),Phaser.Math.Between(0,500)),n.destroy()},onUpdate:()=>{let t=a.value;t>1&&(t-=1);const i=this.getPointFromShape(e,t);s.x=i.x,s.y=i.y,s.updateSuperEmitterPosition()}})}))}}getRandomShape(){const e=Phaser.Math.Between(0,2),t=this.cameras.main.width/2,i=this.cameras.main.height/2;switch(e){case 0:return new Phaser.Geom.Rectangle(t-150,i-150,300,300);case 1:return new Phaser.Geom.Circle(t,i,200);default:return new Phaser.Geom.Ellipse(t,i,200,300)}}getPointFromShape(e,t){return e instanceof Phaser.Geom.Rectangle?Phaser.Geom.Rectangle.GetPoint(e,t):e instanceof Phaser.Geom.Circle?Phaser.Geom.Circle.GetPoint(e,t):Phaser.Geom.Ellipse.GetPoint(e,t)}}class u extends Phaser.Scene{constructor(){super({key:a.LOADING})}preload(){this.cameras.main.setBackgroundColor(10016391),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start(a.MENU)}}class y extends Phaser.Scene{constructor(){super({key:a.MENU})}preload(){this.load.atlas("confetti","assets\\confeti\\confetti.png","assets\\confeti\\confetti.json")}create(){this.add.image(0,0,"bg").setOrigin(0,0),this.add.image(470,200,r.candyTypes[0]),this.add.image(440,210,r.candyTypes[1]),this.add.image(430,180,r.candyTypes[4]),this.add.image(180,170,r.candyTypes[3]),this.add.image(300,220,r.candyTypes[2]),this.add.text(this.cameras.main.width/2,200,"CANDY CRUSH",{fontFamily:"Cambria",fontSize:60,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:4}).setDepth(4).setOrigin(.5,.5).setAlign("center");const e=this.add.rectangle(this.cameras.main.width/2,325,150,50,11622).setStrokeStyle(3,15546518).setInteractive().setName("PlayBtn");e.on("pointerover",(()=>{e.fillColor=2142890})),e.on("pointerout",(()=>{e.fillColor=11622})),this.add.text(this.cameras.main.width/2,325,"PLAY",{fontFamily:"Cambria",fontSize:30,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(4).setOrigin(.5,.5);const t=this.add.rectangle(this.cameras.main.width/2,400,150,50,11622).setStrokeStyle(3,15546518).setInteractive().setName("SettingBtn");t.on("pointerover",(()=>{t.fillColor=2142890})),t.on("pointerout",(()=>{t.fillColor=11622})),this.add.text(this.cameras.main.width/2,400,"SETTING",{fontFamily:"Cambria",fontSize:30,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(4).setOrigin(.5,.5);const i=this.add.rectangle(this.cameras.main.width/2,475,150,50,11622).setStrokeStyle(3,15546518).setInteractive().setName("SettingBtn");i.on("pointerover",(()=>{i.fillColor=2142890})),i.on("pointerout",(()=>{i.fillColor=11622})),this.add.text(this.cameras.main.width/2,475,"EXIT",{fontFamily:"Cambria",fontSize:30,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(4).setOrigin(.5,.5),this.input.on("gameobjectdown",((e,t)=>{("PlayBtn"==t.name||"SettingBtn"==t.name)&&this.scene.start(a.GAMEPLAY)}),this)}}const m={title:"Candy Rush",url:"https://github.com/leanhhuy0709/candy-rush",version:"2.0",type:Phaser.AUTO,parent:"Game",scene:[u,y,T],input:{keyboard:!0},width:600,height:800,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.Center.CENTER_BOTH},backgroundColor:"#000000",render:{pixelArt:!1,antialias:!0},fps:{forceSetTimeOut:!0,panicMax:0,smoothStep:!1,target:100}};class S extends s.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new S(m)}))}},i={};function s(e){var r=i[e];if(void 0!==r)return r.exports;var a=i[e]={exports:{}};return t[e].call(a.exports,a,a.exports,s),a.exports}s.m=t,e=[],s.O=(t,i,r,a)=>{if(!i){var n=1/0;for(d=0;d<e.length;d++){for(var[i,r,a]=e[d],l=!0,h=0;h<i.length;h++)(!1&a||n>=a)&&Object.keys(s.O).every((e=>s.O[e](i[h])))?i.splice(h--,1):(l=!1,a<n&&(n=a));if(l){e.splice(d--,1);var o=r();void 0!==o&&(t=o)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[i,r,a]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var r,a,[n,l,h]=i,o=0;if(n.some((t=>0!==e[t]))){for(r in l)s.o(l,r)&&(s.m[r]=l[r]);if(h)var d=h(s)}for(t&&t(i);o<n.length;o++)a=n[o],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var r=s.O(void 0,[216],(()=>s(476)));r=s.O(r)})();