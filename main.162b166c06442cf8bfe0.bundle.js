(()=>{"use strict";var e,t={579:(e,t,i)=>{var s=i(260);var a;!function(e){e.LOADING="LoadingScene",e.GAMEPLAY="GamePlayScene",e.MENU="MenuScene"}(a||(a={}));class n{static init(e){this.scene=e}static getParticleEmitter(e,t,i,s){return this.scene.add.particles(e,t,i,s)}static removeParticleEmitter(e){e.destroy()}static getExplodeEmitter(e,t,i,s){return this.scene.add.particles(e,t,i,s)}static removeExplodeEmitter(e){e.destroy()}}n.particleEmitterList=[],n.explodeEmitterList=[];class r extends Phaser.GameObjects.Particles.Particle{constructor(e){super(e),this.isInit=!1}update(e,t,i){const s=this.x,a=this.y,n=super.update(e,t,i),r=this.lifeCurrent/this.life,l=Phaser.Math.Easing.Quartic.In(r);return this.x=s+e*this.velocityX/1e3*l,this.y=a+e*this.velocityY/1e3*l,this.angle+=e/1e3*20,n}}const l=175;class o{constructor(e){this.level=1,this.levels=[],this.scene=e,this.score=0,this.scoreText=e.add.text(e.cameras.main.width/2,50,"0",{fontFamily:"Cambria",fontSize:55,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(4).setOrigin(.5,.5);for(let e=1;e<1e3;e++)this.levels.push(e*(e+1)/2*500);this.progressBarEmitter=n.getParticleEmitter(30,60,"flares",{frame:"white",color:[9887962,9666291],colorEase:"quad.out",lifespan:500,angle:{min:-190,max:-170},scale:{start:.2,end:0,ease:"sine.out"},speed:100,advance:2e3,blendMode:"ADD"}).setDepth(7).start(),this.progressBar=this.scene.add.rectangle(30,50,l,20,16110006).setOrigin(0,0).setDepth(3),this.updateProgressBar(0),this.targetText=e.add.text(117.5,30,`${this.levels[this.level]}`,{fontFamily:"Cambria",fontSize:20,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(3).setOrigin(.5,.5),this.confettiEmitter=this.scene.add.particles(0,300,"confetti",{frame:["1","2","3","4","5"],lifespan:3500,scale:{start:.3,end:.5},alpha:{start:75,end:100},angle:{min:-180,max:180},speedX:{min:300,max:800},speedY:{min:-1e3,max:-500},gravityY:1800,quantity:1,particleClass:r}).setDepth(5).stop()}addScore(e){this.score+=e,this.scoreText.setText(this.score.toString()),this.updateProgressBar((this.score-this.levels[this.level-1])/(this.levels[this.level]-this.levels[this.level-1]))}updateProgressBar(e){e<=.05&&(e=.05),e>1&&(e=1),this.progressBar.setSize(e*l,20),this.progressBarEmitter.setPosition(30+e*l-5,60),e>=.3?this.progressBarEmitter.setVisible(!0):this.progressBarEmitter.setVisible(!1)}handleGoToNextLevel(){if(!(this.score<this.levels[this.level])){for(;this.score>=this.levels[this.level];)this.level++;this.targetText.setText(`${this.levels[this.level]}`),this.updateProgressBar((this.score-this.levels[this.level-1])/(this.levels[this.level]-this.levels[this.level-1])),this.scene.shuffle(),this.confettiEmitter.start(void 0,1e3)}}emitterScoreEffect(e,t,i){const s=this.scene.add.image(e,t,"").setVisible(!1),a=n.getParticleEmitter(0,0,"flares",{frame:{frames:["red","green","blue","yellow"],cycle:!0},color:[65280],blendMode:Phaser.BlendModes.ADD,follow:s,speed:100,gravityY:300,lifespan:1e3,quantity:1,scale:{start:.3,end:.1}}).setDepth(7).start();let r=(this.score-this.levels[this.level-1])/(this.levels[this.level]-this.levels[this.level-1]);r<=.05&&(r=.05),r>1&&(r=1);const o=Math.sqrt(Math.pow(30+r*l-e,2)+Math.pow(70-t,2)),h=this.scene.tweens.add({targets:s,x:30+r*l,y:70,duration:2*o,onComplete:()=>{s.destroy(),a.setX(0),a.setY(0),n.removeParticleEmitter(a),h.destroy(),i&&i()}})}static caculateScore(e){switch(e){case 3:return 30;case 4:return 50;case 5:return 90;case 6:return 170;case 7:return 330;case 8:return 600;case 9:return 1e3;case 10:return 2e3;default:return 2e3+70*(e-10)}}}class h extends Phaser.GameObjects.Image{constructor(e,t,i){super(e.scene,e.x,e.y,e.texture,e.frame),this.isSuper=!1,this.isMega=!1,this.setOrigin(.5,.5).setInteractive().setDepth(1),this.gridX=t,this.gridY=i,this.scene.add.existing(this),this.tween=this.scene.tweens.add({targets:this,angle:360,duration:1500,ease:"Linear",repeat:-1}),this.tween.pause(),this.hintTween=this.scene.tweens.add({targets:this,scale:.5,duration:500,ease:"Linear",repeat:-1,yoyo:!0}),this.hintTween.pause()}spin(){this.tween.isPaused()&&(this.tween.restart(),this.tween.resume())}unSpin(){this.tween.pause();const e=this.scene.tweens.add({targets:this,angle:0,duration:800*Math.abs(this.angle)/300,ease:"Linear",onComplete:()=>e.destroy()})}showGraphics(){}hideGraphics(){}setGraphics(){}getKey(){return this.frame.name}selectEffect(){this.spin(),this.showGraphics()}unSelectEffect(){this.unSpin(),this.hideGraphics()}updatePositon(e=!0,t,i,s,a){const n=this.scene.cameras.main.width;let r=500;s&&(r=s),i||(i=0);const l=32+74*this.gridX+(n-592),o=36+82*this.gridY+100;if(e){h.numTweenRunning++;const e=this.scene.tweens.add({targets:this,x:l,y:o,delay:i,duration:r,ease:Phaser.Math.Easing.Bounce.Out,onComplete:()=>{a&&a(),h.numTweenRunning--,t&&0==h.numTweenRunning&&t(),e.destroy()}});if(this.superEmitter){const e=this.scene.tweens.add({targets:this.superEmitter,x:l,y:o+10,delay:i,duration:r,ease:Phaser.Math.Easing.Bounce.Out,onComplete:()=>e.destroy()})}}else this.x=l,this.y=o}goToPosition(e,t,i,s,a,n){a||(a=500),h.numTweenRunning++;const r=this.scene.tweens.add({targets:this,x:e,y:t,delay:s,duration:a,ease:Phaser.Math.Easing.Quintic.Out,onComplete:()=>{h.numTweenRunning--,i&&i(),n&&0==h.numTweenRunning&&n(),r.destroy()}});if(this.superEmitter){const i=this.scene.tweens.add({targets:this.superEmitter,x:e,y:t+10,delay:s,duration:a,ease:Phaser.Math.Easing.Bounce.Out,onComplete:()=>i.destroy()})}}showHint(){this.hintTween.resume(),this.showGraphics()}hideHint(){this.hintTween.pause(),this.scene.tweens.add({targets:this,scale:1,duration:1e3,ease:"Linear"}),this.hideGraphics()}boom(){if(!(h.boomFlag>10))if(h.boomFlag++,this.isSuperTile()||this.isMegaTile()){const e=n.getExplodeEmitter(this.x,this.y,"flares",{frame:["red"],lifespan:400,speed:{min:150,max:250},scale:{start:.3,end:0},gravityY:150,blendMode:"ADD",emitting:!1}).setDepth(7);e.explode(16),setTimeout((()=>{n.removeExplodeEmitter(e)}),500)}else{const e=n.getExplodeEmitter(this.x,this.y,"flares",{frame:["blue"],lifespan:400,speed:{min:150,max:250},scale:{start:.3,end:0},gravityY:150,blendMode:"ADD",emitting:!1}).setDepth(7);e.explode(16),setTimeout((()=>{n.removeExplodeEmitter(e)}),1e3)}}static bigBoom(){if(h.boomFlag<=10)return;const e=n.getExplodeEmitter(300,400,"flares",{frame:["red","blue"],lifespan:1e3,speed:{min:350,max:450},scale:{start:.75,end:0},gravityY:150,blendMode:"ADD",emitting:!1}).setDepth(7);e.explode(50),setTimeout((()=>{n.removeExplodeEmitter(e)}),2e3)}setSuper(e=!0){this.isSuper=e,this.superEmitter&&(n.removeParticleEmitter(this.superEmitter),this.superEmitter=null),e&&(this.superEmitter=n.getParticleEmitter(this.x,this.y+20,"flares",{frame:"blue",color:[61696],colorEase:"quart.out",lifespan:500,angle:{min:-100,max:-80},scale:{start:.75,end:0,ease:"sine.out"},speed:{min:200,max:300},advance:2e3,blendMode:"ADD"}).setDepth(6).start())}setMega(e=!0){this.isMega=e,this.superEmitter&&(n.removeParticleEmitter(this.superEmitter),this.superEmitter=null),e&&(this.superEmitter=n.getParticleEmitter(this.x,this.y+20,"flares",{frame:["red"],color:[16711680],lifespan:500,angle:{min:-100,max:-80},scale:{start:.75,end:0,ease:"sine.out"},speed:{min:200,max:300},advance:2e3,blendMode:"ADD"}).setDepth(6).start())}isSuperTile(){return this.isSuper}isMegaTile(){return this.isMega}updateSuperEmitterPosition(){this.superEmitter&&(this.superEmitter.x=this.x,this.superEmitter.y=this.y+10)}goto(e){if(e.isNotTween)return this.x=e.x,this.y=e.y,void this.updateSuperEmitterPosition();h.numTweenRunning++;const t=this.scene.tweens.add({targets:this,x:e.x,y:e.y,delay:e.delay?e.delay:0,duration:e.duration?e.duration:500,ease:e.ease?e.ease:Phaser.Math.Easing.Linear,onComplete:()=>{h.numTweenRunning--,e.onComplete&&e.onComplete(),e.onCompleteAll&&0==h.numTweenRunning&&e.onCompleteAll(),t.destroy()},onUpdate:()=>{this.updateSuperEmitterPosition()}})}gotoGrid(e){const t=32+74*this.gridX+(this.scene.cameras.main.width-592),i=36+82*this.gridY+100;this.goto({x:t,y:i,isNotTween:e.isNotTween,delay:e.delay,duration:e.duration,ease:e.ease,onComplete:e.onComplete,onCompleteAll:e.onCompleteAll})}setGrid(e,t,i){null==t&&(t=this.gridX),null==i&&(i=this.gridY),e.removeTile(this.gridX,this.gridY),this.gridX=t,this.gridY=i,e.setTile(this.gridX,this.gridY,this)}}h.numTweenRunning=0,h.boomFlag=0;class c{constructor(e){this.scene=e,this.tileMap=new Map,this.numCandy=5;for(let e=0;e<8;e++)for(let t=0;t<8;t++)this.setTile(e,t,new h({scene:this.scene,x:this.scene.cameras.main.width/2,y:this.scene.cameras.main.height/2,texture:"candy",frame:0},e,t))}getTile(e,t){return this.tileMap.get(e.toString()+t.toString())}getTile2(e){return this.tileMap.get(e)}setTile(e,t,i){this.tileMap.set(e.toString()+t.toString(),i)}removeTile(e,t){this.tileMap.delete(e.toString()+t.toString())}shuffleCandyList(){}getTileMap(){return this.tileMap}swapTilesWithoutEffect(e,t,i,s){const a=this.getTile(e,t),n=this.getTile(i,s);a&&n?(this.setTile(e,t,n),this.setTile(i,s,a),a.gridX=i,a.gridY=s,n.gridX=e,n.gridY=t):console.log("Error swap!")}convertToKey(e,t){return e.toString()+t.toString()}handleMatch(e,t){this.scene.boardState=d.HANDLING;let i=1;const s=[0],a=new Map,n=[];n.push(this.getTile(0,0));const r=new Map,l=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}],o=[];for(;e.length>0;){const t=e.pop(),h=this.getTile(t.x,t.y);if(2==r.get(this.convertToKey(t.x,t.y)))continue;r.set(this.convertToKey(t.x,t.y),2);let c=a.get(this.convertToKey(t.x,t.y)),d=!1,g=!1;for(const e of l){const i=this.getTile(t.x+e.x,t.y+e.y);if(!i||i.getKey()!==h.getKey())continue;const s=this.getTile(t.x-e.x,t.y-e.y),a=this.getTile(t.x+2*e.x,t.y+2*e.y),n=s&&s.getKey()===h.getKey(),r=a&&a.getKey()===h.getKey();(n||r)&&(g=!0)}if(g){c||(c=i,s.push(1),n.push(h),i++,a.set(this.convertToKey(t.x,t.y),c));for(const i of l){const n=this.getTile(t.x+i.x,t.y+i.y);if(!n||n.getKey()!==h.getKey())continue;const l=this.getTile(t.x-i.x,t.y-i.y),o=this.getTile(t.x+2*i.x,t.y+2*i.y),g=l&&l.getKey()===h.getKey(),u=o&&o.getKey()===h.getKey();if(g||u){let n=a.get(this.convertToKey(t.x+i.x,t.y+i.y));n||(n=c,a.set(this.convertToKey(t.x+i.x,t.y+i.y),c),s[c]++),r.get(this.convertToKey(t.x+i.x,t.y+i.y))||(r.set(this.convertToKey(t.x+i.x,t.y+i.y),1),e.push({x:t.x+i.x,y:t.y+i.y})),d=!0}if(g){let n=a.get(this.convertToKey(t.x-i.x,t.y-i.y));n||(n=c,a.set(this.convertToKey(t.x-i.x,t.y-i.y),c),s[c]++),r.get(this.convertToKey(t.x-i.x,t.y-i.y))||(r.set(this.convertToKey(t.x-i.x,t.y-i.y),1),e.push({x:t.x-i.x,y:t.y-i.y}))}if(u){let n=a.get(this.convertToKey(t.x+2*i.x,t.y+2*i.y));n||(n=c,a.set(this.convertToKey(t.x+2*i.x,t.y+2*i.y),c),s[c]++),r.get(this.convertToKey(t.x+2*i.x,t.y+2*i.y))||(r.set(this.convertToKey(t.x+2*i.x,t.y+2*i.y),1),e.push({x:t.x+2*i.x,y:t.y+2*i.y}))}}d&&(h.isSuperTile()||h.isMegaTile())&&o.push({x:t.x,y:t.y})}}for(;o.length>0;){const e=o.pop(),t=this.getTile(e.x,e.y);if(t.isSuperTile()){for(let t=-1;t<=1;t++)for(let i=-1;i<=1;i++){const s=this.getTile(e.x+t,e.y+i);s&&(a.get(this.convertToKey(e.x+t,e.y+i))||(a.set(this.convertToKey(e.x+t,e.y+i),0),(s.isSuperTile()||s.isMegaTile())&&o.push({x:e.x+t,y:e.y+i})))}t.setSuper(!1)}else if(t.isMegaTile()){for(let t=0;t<=8;t++){let i=this.getTile(t,e.y);i&&(a.get(this.convertToKey(t,e.y))||(a.set(this.convertToKey(t,e.y),0),(i.isSuperTile()||i.isMegaTile())&&o.push({x:t,y:e.y}))),i=this.getTile(e.x,t),i&&(a.get(this.convertToKey(e.x,t))||(a.set(this.convertToKey(e.x,t),0),(i.isSuperTile()||i.isMegaTile())&&o.push({x:e.x,y:t})))}t.setMega(!1)}}this.handleMerge(a,s,n,t)}handleMerge(e,t,i,s){this.scene.boardState=d.MERGING;const a=[];for(let e=0;e<8;e++)a.push(3);let n=!1;for(const[r,l]of e){if(l>0&&t[l]<3)continue;const e=this.getIndexFromKey(r),h=this.getTile(e.x,e.y);if(!h){console.log("Error index tile!");continue}a[e.x]++;const c=-a[e.x],d=i[l];d.gridX==h.gridX&&d.gridY==h.gridY?this.scene.scoreBoard.emitterScoreEffect(d.x,d.y,(()=>{this.scene.scoreBoard.addScore(o.caculateScore(t[l]))})):0==l&&this.scene.scoreBoard.addScore(15),3!=t[l]&&0!=l?(n=!0,d.gridX!=h.gridX||d.gridY!=h.gridY?(h.boom(),h.goto({x:d.x,y:d.y,duration:300,ease:Phaser.Math.Easing.Linear,onComplete:()=>{h.setVisible(!1),h.setGrid(this,void 0,c),h.gotoGrid({isNotTween:!0})},onCompleteAll:()=>{this.handleFall(a,s)}})):(4==t[l]?d.isSuperTile()||d.setSuper():t[l]>=5&&(d.isMegaTile()||d.setMega()),a[e.x]--)):(h.boom(),h.setGrid(this,void 0,c),h.gotoGrid({isNotTween:!0}),h.setVisible(!1),this.scene.scoreBoard.addScore(10))}n||this.handleFall(a,s)}handleFall(e,t){h.boomFlag>10&&h.bigBoom(),h.boomFlag=0,this.scene.boardState=d.FALLING;let i=!1;for(let t=0;t<e.length;t++)e[t]>3&&(i=!0);if(!i)return t&&t(!1),void(this.scene.boardState=d.IDLE);const s=[];for(let e=0;e<8;e++)s.push(-1);for(let i=0;i<8;i++){let a=0;for(let n=7;n>=-e[i];n--){const e=this.getTile(i,n);e?a>0&&(n<0&&e.setTexture("candy",this.getRandomFrame()).setVisible(!0).setAngle(0),e.setGrid(this,void 0,n+a),e.gotoGrid({duration:100*a+200,delay:200,ease:Phaser.Math.Easing.Bounce.Out,onCompleteAll:()=>{t&&t();const e=[];for(let t=0;t<8;t++)for(let i=0;i<=s[t];i++)e.push({x:t,y:i});e.length>0?this.handleMatch(e,t):t&&t()}})):(0==a&&(s[i]=n),a++)}}}getIndexFromKey(e){switch(e.length){case 2:return{x:parseInt(e[0]),y:parseInt(e[1])};case 3:return"-"==e[0]?{x:parseInt(e[0]+e[1]),y:parseInt(e[2])}:{x:parseInt(e[0]),y:parseInt(e[1]+e[2])};default:return{x:parseInt(e[0]+e[1]),y:parseInt(e[2]+e[3])}}}getRandomFrame(e,t){if(null==e||null==t)return Phaser.Math.Between(0,this.numCandy-1);if(Math.random()<.333){const i=[];if(this.getTile(e-1,t)&&i.push(this.getTile(e-1,t)),this.getTile(e+1,t)&&i.push(this.getTile(e+1,t)),this.getTile(e,t-1)&&i.push(this.getTile(e,t-1)),this.getTile(e,t+1)&&i.push(this.getTile(e,t+1)),i.length>0)return Number(i[Phaser.Math.Between(0,i.length-1)].getKey())}return Phaser.Math.Between(0,this.numCandy-1)}findBestMove(){const e=[void 0,void 0];let t=0;for(let i=0;i<8;i++)for(let s=0;s<8;s++){const a=this.getTile(i,s),n=this.getTile(i,s+1),r=this.getTile(i,s+2);if(a||console.log("Error index tile!"),n&&r){if(a.getKey()==n.getKey()){const n=this.getTile(i-1,s+2),l=this.getTile(i+1,s+2),o=this.getTile(i,s+3);if(n&&n.getKey()==a.getKey()){const i=this.countComboDFSIfMove(n,r);i>t&&(t=i,e[0]=r,e[1]=n)}else if(l&&l.getKey()==a.getKey()){const i=this.countComboDFSIfMove(l,r);i>t&&(t=i,e[0]=r,e[1]=l)}else if(o&&o.getKey()==a.getKey()){const i=this.countComboDFSIfMove(o,r);i>t&&(t=i,e[0]=r,e[1]=o)}}if(a.getKey()==r.getKey()){const l=this.getTile(i-1,s+1),o=this.getTile(i+1,s+1);if(l&&l.getKey()==a.getKey()){const i=this.countComboDFSIfMove(l,n);i>t&&(t=i,e[0]=n,e[1]=l)}else if(o&&o.getKey()==a.getKey()){const i=this.countComboDFSIfMove(r,o);i>t&&(t=i,e[0]=n,e[1]=o)}}}}for(let i=0;i<8;i++)for(let s=0;s<8;s++){const a=this.getTile(i,s),n=this.getTile(i+1,s),r=this.getTile(i+2,s);if(a||console.log("Error index tile!"),n&&r){if(a.getKey()==n.getKey()){const n=this.getTile(i+2,s-1),l=this.getTile(i+2,s+1),o=this.getTile(i+3,s);if(n&&n.getKey()==a.getKey()){const i=this.countComboDFSIfMove(n,r);i>t&&(t=i,e[0]=r,e[1]=n)}else if(l&&l.getKey()==a.getKey()){const i=this.countComboDFSIfMove(l,r);i>t&&(t=i,e[0]=r,e[1]=l)}else if(o&&o.getKey()==a.getKey()){const i=this.countComboDFSIfMove(o,r);i>t&&(t=i,e[0]=r,e[1]=o)}}if(a.getKey()==r.getKey()){const l=this.getTile(i+1,s-1),o=this.getTile(i+1,s+1);if(l&&l.getKey()==a.getKey()){const i=this.countComboDFSIfMove(l,n);i>t&&(t=i,e[0]=n,e[1]=l)}else if(o&&o.getKey()==a.getKey()){const i=this.countComboDFSIfMove(r,o);i>t&&(t=i,e[0]=n,e[1]=o)}}}}return console.log(t),e}countComboDFSIfMove(e,t){const i=[],s=e.gridX,a=e.gridY,n=t.gridX,r=t.gridY,l=new Map,o=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}];for(const t of o){const s=this.getTile(n+t.x,r+t.y);s&&s.getKey()==e.getKey()&&(i.push(s),l.set(this.convertToKey(n+t.x,r+t.y),!0))}i.push(e),l.set(this.convertToKey(s,a),!0);let h=0;for(console.log(i.map((e=>[e.gridX,e.gridY])));i.length>0;){const e=i.pop();h++;for(const t of o){const s=this.getTile(e.gridX+t.x,e.gridY+t.y);s&&s.getKey()==e.getKey()&&(l.get(this.convertToKey(s.gridX,s.gridY))||(i.push(s),l.set(this.convertToKey(s.gridX,s.gridY),!0)))}}return h}}var d;!function(e){e.IDLE="Idle",e.CHOOSING="Choosing",e.SWAPPING="Swapping",e.HANDLING="Handling",e.FALLING="Falling",e.MERGING="Merging"}(d||(d={}));class g extends Phaser.Scene{addStats(){this.stats=document.createElement("span"),this.stats.style.position="fixed",this.stats.style.left="0",this.stats.style.bottom="0",this.stats.style.backgroundColor="black",this.stats.style.minWidth="200px",this.stats.style.padding="15px",this.stats.style.color="white",this.stats.style.fontFamily="Courier New",this.stats.style.textAlign="center",this.stats.innerText="Draw calls: ?",document.body.append(this.stats)}countDrawCalls(){const e=this.game.renderer;if(e instanceof Phaser.Renderer.WebGL.WebGLRenderer){let t=0;const i=e.pipelines.pipelines.values();e.on(Phaser.Renderer.Events.PRE_RENDER,(()=>t=0)),i.forEach((e=>e.on(Phaser.Renderer.WebGL.Pipelines.Events.AFTER_FLUSH,(()=>t++)))),e.on(Phaser.Renderer.Events.POST_RENDER,(()=>this.redrawStats(t)))}else e.on(Phaser.Renderer.Events.POST_RENDER,(()=>this.redrawStats(e.drawCount)))}redrawStats(e=0){this.stats.innerText=`Draw calls: ${e}`}debugConsole(){}constructor(){super({key:a.GAMEPLAY})}create(){this.add.image(0,0,"bg").setOrigin(0,0),n.init(this),this.tileManager=new c(this),this.shuffle(),this.scoreBoard=new o(this),this.input.on("gameobjectdown",this.onTileClicked,this)}update(e,t){switch(0==this.idleTime&&(this.isIdleTweenPlaying=!1),this.idleTime+=t,this.handleIdleTime(),this.boardState!=d.IDLE&&(this.idleTime=0),this.boardState){case d.IDLE:this.scoreBoard.handleGoToNextLevel(),this.resetSelect();break;case d.CHOOSING:case d.SWAPPING:this.firstSelectedTile&&this.firstSelectedTile.selectEffect(),this.secondSelectedTile&&this.secondSelectedTile.selectEffect();break;case d.HANDLING:case d.FALLING:case d.MERGING:this.resetSelect()}this.debugConsole()}onTileClicked(e,t){this.boardState!=d.IDLE&&this.boardState!=d.CHOOSING||(this.firstSelectedTile?this.secondSelectedTile||(this.secondSelectedTile=t,this.isValidSelect()?this.swapTiles((()=>{this.firstSelectedTile&&this.secondSelectedTile&&this.handleMatch(((e=!0)=>{e?this.resetSelect():this.swapTiles((()=>{this.resetSelect()}))}))})):this.resetSelect()):(this.boardState=d.CHOOSING,this.firstSelectedTile=t))}resetSelect(){this.firstSelectedTile&&this.firstSelectedTile.unSelectEffect(),this.secondSelectedTile&&this.secondSelectedTile.unSelectEffect(),this.firstSelectedTile=null,this.secondSelectedTile=null}isValidSelect(){if(this.firstSelectedTile&&this.secondSelectedTile){const e=this.firstSelectedTile.gridX,t=this.firstSelectedTile.gridY,i=this.secondSelectedTile.gridX,s=this.secondSelectedTile.gridY;return Math.abs(e-i)+Math.abs(t-s)===1}return!1}swapTiles(e){if(this.boardState=d.SWAPPING,this.firstSelectedTile&&this.secondSelectedTile){const t=this.firstSelectedTile.x,i=this.firstSelectedTile.y,s=this.secondSelectedTile.x,a=this.secondSelectedTile.y,n=500;this.firstSelectedTile.goToPosition(s,a,void 0,void 0,n,(()=>{e()})),this.secondSelectedTile.goToPosition(t,i,void 0,void 0,n,(()=>{e()})),this.tileManager.swapTilesWithoutEffect(this.firstSelectedTile.gridX,this.firstSelectedTile.gridY,this.secondSelectedTile.gridX,this.secondSelectedTile.gridY)}}handleMatch(e){if(this.boardState==d.IDLE||this.boardState==d.SWAPPING)if(this.boardState=d.HANDLING,this.firstSelectedTile&&this.secondSelectedTile)this.tileManager.handleMatch([{x:this.secondSelectedTile.gridX,y:this.secondSelectedTile.gridY},{x:this.firstSelectedTile.gridX,y:this.firstSelectedTile.gridY}],((t=!0)=>{e&&e(t),this.boardState=d.IDLE}));else{const t=[];for(let e=0;e<8;e++)for(let i=0;i<8;i++)t.push({x:e,y:i});this.tileManager.handleMatch(t,((t=!0)=>{e&&e(t),this.boardState=d.IDLE}))}}idleEffect(){if(this.boardState==d.IDLE){for(let e=0;e<8;e++)for(let t=0;t<8;t++){const i=this.tileManager.getTile(e,t);if(!this.isIdleTweenPlaying){const s=this.tweens.add({targets:i,angle:360,delay:(8*e+t)/64*1e3,duration:1e3,ease:"Linear",onComplete:()=>{s.destroy()}})}}this.isIdleTweenPlaying=!0}}handleIdleTime(){this.idleTime>5e3&&this.boardState==d.IDLE?(this.firstSelectedTile&&(this.firstSelectedTile.unSelectEffect(),this.firstSelectedTile=null),this.idleEffect(),this.showHint()):this.hideHint()}handleHint(){const e=[];for(let t=0;t<8;t++)for(let i=0;i<8;i++){const s=this.tileManager.getTile(t,i),a=this.tileManager.getTile(t,i+1),n=this.tileManager.getTile(t,i+2);if(a){if(s.getKey()===a.getKey()){const a=[{T1:this.tileManager.getTile(t-1,i-1),T2:this.tileManager.getTile(t,i-1)},{T1:this.tileManager.getTile(t+1,i-1),T2:this.tileManager.getTile(t,i-1)},{T1:this.tileManager.getTile(t-1,i+2),T2:this.tileManager.getTile(t,i+2)},{T1:this.tileManager.getTile(t+1,i+2),T2:this.tileManager.getTile(t,i+2)},{T1:this.tileManager.getTile(t,i-2),T2:this.tileManager.getTile(t,i-1)},{T1:this.tileManager.getTile(t,i+3),T2:this.tileManager.getTile(t,i+2)}];for(let t=0;t<a.length;t++){const i=a[t].T1,n=a[t].T2;if(i&&n&&s.getKey()===i.getKey())return e.push(i),e.push(n),e}}if(n&&s.getKey()===n.getKey()){const a=[{T1:this.tileManager.getTile(t-1,i+1),T2:this.tileManager.getTile(t,i+1)},{T1:this.tileManager.getTile(t+1,i+1),T2:this.tileManager.getTile(t,i+1)}];for(let t=0;t<a.length;t++){const i=a[t].T1,n=a[t].T2;if(i&&n&&s.getKey()===i.getKey())return e.push(i),e.push(n),e}}}}for(let t=0;t<8;t++)for(let i=0;i<8;i++){const s=this.tileManager.getTile(t,i),a=this.tileManager.getTile(t+1,i),n=this.tileManager.getTile(t+2,i);if(a){if(s.getKey()===a.getKey()){const a=[{T1:this.tileManager.getTile(t-1,i-1),T2:this.tileManager.getTile(t-1,i)},{T1:this.tileManager.getTile(t-1,i+1),T2:this.tileManager.getTile(t-1,i)},{T1:this.tileManager.getTile(t+2,i-1),T2:this.tileManager.getTile(t+2,i)},{T1:this.tileManager.getTile(t+2,i+1),T2:this.tileManager.getTile(t+2,i)},{T1:this.tileManager.getTile(t-2,i),T2:this.tileManager.getTile(t-1,i)},{T1:this.tileManager.getTile(t+3,i),T2:this.tileManager.getTile(t+2,i)}];for(let t=0;t<a.length;t++){const i=a[t].T1,n=a[t].T2;if(i&&n&&s.getKey()===i.getKey())return e.push(i),e.push(n),e}}if(n&&s.getKey()===n.getKey()){const a=[{T1:this.tileManager.getTile(t+1,i-1),T2:this.tileManager.getTile(t+1,i)},{T1:this.tileManager.getTile(t+1,i+1),T2:this.tileManager.getTile(t+1,i)}];for(let t=0;t<a.length;t++){const i=a[t].T1,n=a[t].T2;if(i&&n&&s.getKey()===i.getKey())return e.push(i),e.push(n),e}}}}return e}showHint(){const e=this.handleHint();0!=e.length?(this.hintTile1=e[0],this.hintTile2=e[1],this.hintTile1&&this.hintTile2&&(this.hintTile1.showHint(),this.hintTile2.showHint())):this.shuffle()}hideHint(){this.hintTile1&&this.hintTile2&&(this.hintTile1.hideHint(),this.hintTile2.hideHint(),this.firstSelectedTile&&this.firstSelectedTile.showGraphics(),this.hintTile1=this.hintTile2=null)}shuffle(){const e=Math.random();e<=.33?this.shuffle3D_2():e<=.66?this.shuffle3D_3():this.shuffle3D()}getRandomShape(){const e=Phaser.Math.Between(0,5),t=this.cameras.main.width/2,i=this.cameras.main.height/2;switch(e){case 0:return new Phaser.Geom.Rectangle(t-150,i-150,300,300);case 1:return new Phaser.Geom.Circle(t,i,200);case 2:return new Phaser.Geom.Ellipse(t,i,300,200);case 3:return new Phaser.Geom.Ellipse(t,i,200,300);case 4:return new Phaser.Geom.Triangle(t,i-200,t-200,i+200,t+200,i+200);default:return new Phaser.Geom.Rectangle(t-200,i-100,400,200)}}getPointFromShape(e,t){return e instanceof Phaser.Geom.Rectangle?Phaser.Geom.Rectangle.GetPoint(e,t):e instanceof Phaser.Geom.Circle?Phaser.Geom.Circle.GetPoint(e,t):e instanceof Phaser.Geom.Ellipse?Phaser.Geom.Ellipse.GetPoint(e,t):Phaser.Geom.Triangle.GetPoint(e,t)}shuffle3D(){this.boardState=d.HANDLING;const e=this.cameras.main.width/2,t=this.cameras.main.height/2;let i=-.1,s=!0;const a=new Phaser.Geom.Ellipse(e,t,400,400);this.tileManager.shuffleCandyList();for(let e=0;e<8;e++)for(let t=0;t<8;t++){const n=this.tileManager.getTile(e,t);n.setTexture("candy",this.tileManager.getRandomFrame(n.gridX,n.gridY));const r={value:(8*e+t)/64,test:5e3},l=this.getPointFromShape(a,r.value);n.goToPosition(l.x,l.y,(()=>{const l=this.tweens.add({targets:r,test:0,duration:3e3,ease:"Linear",onComplete:()=>{var i;n.setFlipX(!1),null===(i=this.tileManager.getTile(e,t))||void 0===i||i.updatePositon(!0,(()=>{this.tileManager.shuffleCandyList(),this.boardState=d.IDLE,this.handleMatch()}),Phaser.Math.Between(0,500)),l.destroy()},onUpdate:()=>{a.width+=i;let e=r.value;e>1&&(e-=1);let t=0;s?(0<=e&&e<.25?t=1-e:(.25<=e&&e<.5||.5<=e&&e<.75||.75<=e&&e<=1)&&(t=e),n.setFlipX(!0)):(0<=e&&e<.25?t=e:(.25<=e&&e<.5||.5<=e&&e<.75||.75<=e&&e<=1)&&(t=1-e),n.setFlipX(!1));let l=1.5*(1-Math.abs(a.width)/400);l>=1?l=1:l<=.1&&(l=.1),n.scaleX=l,n.setDepth(1+t),a.width<=-400&&(i=.1,s=!s),a.width>=400&&(i=-.1,s=!s);const o=this.getPointFromShape(a,e);n.x=o.x,n.y=o.y,n.updateSuperEmitterPosition()},repeat:3})}))}}shuffle3D_2(){this.boardState=d.HANDLING;const e=this.cameras.main.width/2,t=this.cameras.main.height/2,i={x:e,y:t-200},s={x:e-200,y:t+200},a={x:e+200,y:t+200},n={x:e,y:t+100},r=new Phaser.Geom.Line(s.x,s.y,n.x,n.y),l=new Phaser.Geom.Line(n.x,n.y,a.x,a.y),o=new Phaser.Geom.Line(a.x,a.y,s.x,s.y),h=new Phaser.Geom.Line(s.x,s.y,i.x,i.y),c=new Phaser.Geom.Line(i.x,i.y,a.x,a.y),g=new Phaser.Geom.Line(i.x,i.y,n.x,n.y);this.tileManager.shuffleCandyList();for(let e=0;e<8;e++)for(let t=0;t<8;t++){const i=this.tileManager.getTile(e,t);i.setTexture("candy",this.tileManager.getRandomFrame(i.gridX,i.gridY));const s={value:(8*e+t)/64,test:5e3};let a={x:0,y:0};s.value<=1/6?(a=r.getPoint(6*s.value),i.setDepth(1)):s.value<=2/6?(a=l.getPoint(6*(s.value-1/6)),i.setDepth(1.2)):s.value<=.5?(a=o.getPoint(6*(s.value-2/6)),i.setDepth(1.4)):s.value<=4/6?(a=h.getPoint(6*(s.value-.5)),i.setDepth(1.5)):s.value<=5/6?(a=c.getPoint(6*(s.value-4/6)),i.setDepth(1.6)):(a=g.getPoint(6*(s.value-5/6)),i.setDepth(.9)),i.goToPosition(a.x,a.y,(()=>{const a=this.tweens.add({targets:s,test:0,value:(8*e+t)/64+1,duration:2e3,ease:"Linear",onComplete:()=>{var i;null===(i=this.tileManager.getTile(e,t))||void 0===i||i.updatePositon(!0,(()=>{this.tileManager.shuffleCandyList(),this.boardState=d.IDLE,this.handleMatch()}),Phaser.Math.Between(0,500)),a.destroy()},onUpdate:()=>{let e=s.value;e>1&&(e-=1);let t={x:0,y:0};e<=1/6?(t=r.getPoint(6*e),i.setDepth(1)):e<=2/6?(t=l.getPoint(6*(e-1/6)),i.setDepth(1.2)):e<=.5?(t=o.getPoint(6*(e-2/6)),i.setDepth(1.4)):e<=4/6?(t=h.getPoint(6*(e-.5)),i.setDepth(1.5)):e<=5/6?(t=c.getPoint(6*(e-4/6)),i.setDepth(1.6)):(t=g.getPoint(6*(e-5/6)),i.setDepth(.9)),i.x=t.x,i.y=t.y,i.updateSuperEmitterPosition()},repeat:1})}))}}shuffle3D_3(){this.boardState=d.HANDLING;const e=this.cameras.main.width/2,t=this.cameras.main.height/2,i={x:e,y:t},s={x:e-200,y:t-200},a={x:e+200,y:t-200},n={x:e+200,y:t+200},r={x:e-200,y:t+200},l=Math.sqrt(Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2)),o=new Phaser.Geom.Line(s.x,s.y,n.x,n.y),h=new Phaser.Geom.Line(a.x,a.y,r.x,r.y),c=new Phaser.Geom.Circle(i.x,i.y,l),g=[l,l/2*Math.PI,2*l,l/2*Math.PI,l];let u=0;for(let e=0;e<g.length;e++)u+=g[e];for(let e=0;e<g.length;e++)e>0?g[e]=g[e]/u+g[e-1]:g[e]/=u;this.tileManager.shuffleCandyList();for(let e=0;e<8;e++)for(let t=0;t<8;t++){const i=this.tileManager.getTile(e,t);i.setTexture("candy",this.tileManager.getRandomFrame(i.gridX,i.gridY));const s={value:(8*e+t)/64,test:5e3};let a={x:0,y:0},n=0,r=0;for(;n<g.length&&(n>0&&(r=g[n-1]),!(s.value<=g[n]));n++);switch(n){case 0:a=h.getPoint(.5*(1-(s.value-r)/(g[n]-r))),i.setDepth(s.value);break;case 1:a=c.getPoint(2*(1-(s.value-r)/(g[n]-r))/8+5/8),i.setDepth(s.value);break;case 2:a=o.getPoint((s.value-r)/(g[n]-r)),i.setDepth(s.value);break;case 3:a=c.getPoint((s.value-r)/(g[n]-r)*2/8+1/8),i.setDepth(s.value);break;default:a=h.getPoint(.5*(1-(s.value-r)/(g[n]-r))+.5),i.setDepth(s.value)}i.goToPosition(a.x,a.y,(()=>{const a=this.tweens.add({targets:s,test:0,value:(8*e+t)/64+1,duration:4e3,ease:"Linear",onComplete:()=>{var i;null===(i=this.tileManager.getTile(e,t))||void 0===i||i.updatePositon(!0,(()=>{this.tileManager.shuffleCandyList(),this.boardState=d.IDLE,this.handleMatch()}),Phaser.Math.Between(0,500)),a.destroy()},onUpdate:()=>{let e=s.value;e>1&&(e-=1);let t=0,a=0;for(;t<g.length&&(t>0&&(a=g[t-1]),!(e<=g[t]));t++);let n={x:0,y:0};switch(t){case 0:n=h.getPoint(.5*(1-(e-a)/(g[t]-a))),i.setDepth(e);break;case 1:n=c.getPoint(2*(1-(e-a)/(g[t]-a))/8+5/8),i.setDepth(e);break;case 2:n=o.getPoint((e-a)/(g[t]-a)),i.setDepth(e);break;case 3:n=c.getPoint((e-a)/(g[t]-a)*2/8+1/8),i.setDepth(e);break;default:n=h.getPoint(.5*(1-(e-a)/(g[t]-a))+.5),i.setDepth(e)}i.x=n.x,i.y=n.y,i.updateSuperEmitterPosition()},repeat:1})}))}}}class u extends Phaser.Scene{constructor(){super({key:a.LOADING})}preload(){this.cameras.main.setBackgroundColor(10016391),this.load.pack("preload","./assets/pack.json","preload"),this.load.spritesheet("candy","./assets/images/spritesheet.png",{frameWidth:64,frameHeight:72})}update(){this.scene.start(a.MENU)}}class y extends Phaser.Scene{constructor(){super({key:a.MENU})}preload(){this.load.atlas("confetti","assets\\confeti\\confetti.png","assets\\confeti\\confetti.json")}create(){this.add.image(0,0,"bg").setOrigin(0,0),this.add.image(470,200,"candy",0),this.add.image(440,210,"candy",1),this.add.image(430,180,"candy",4),this.add.image(180,170,"candy",3),this.add.image(300,220,"candy",2),this.add.text(this.cameras.main.width/2,200,"CANDY CRUSH",{fontFamily:"Cambria",fontSize:60,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:4}).setDepth(4).setOrigin(.5,.5).setAlign("center");const e=this.add.rectangle(this.cameras.main.width/2,325,150,50,11622).setStrokeStyle(3,15546518).setInteractive().setName("PlayBtn");e.on("pointerover",(()=>{e.fillColor=2142890})),e.on("pointerout",(()=>{e.fillColor=11622})),this.add.text(this.cameras.main.width/2,325,"PLAY",{fontFamily:"Cambria",fontSize:30,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(4).setOrigin(.5,.5);const t=this.add.rectangle(this.cameras.main.width/2,400,150,50,11622).setStrokeStyle(3,15546518).setInteractive().setName("SettingBtn");t.on("pointerover",(()=>{t.fillColor=2142890})),t.on("pointerout",(()=>{t.fillColor=11622})),this.add.text(this.cameras.main.width/2,400,"SETTING",{fontFamily:"Cambria",fontSize:30,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(4).setOrigin(.5,.5);const i=this.add.rectangle(this.cameras.main.width/2,475,150,50,11622).setStrokeStyle(3,15546518).setInteractive().setName("SettingBtn");i.on("pointerover",(()=>{i.fillColor=2142890})),i.on("pointerout",(()=>{i.fillColor=11622})),this.add.text(this.cameras.main.width/2,475,"EXIT",{fontFamily:"Cambria",fontSize:30,color:"#ffffff",fontStyle:"bold",stroke:"#000000",strokeThickness:2}).setDepth(4).setOrigin(.5,.5),this.input.on("gameobjectdown",((e,t)=>{("PlayBtn"==t.name||"SettingBtn"==t.name)&&this.scene.start(a.GAMEPLAY)}),this)}update(){}}const f={title:"Candy Rush",url:"https://github.com/leanhhuy0709/candy-rush",version:"2.0",type:Phaser.AUTO,parent:"Game",scene:[u,y,g],input:{keyboard:!0},scale:{mode:Phaser.Scale.ScaleModes.FIT,autoCenter:Phaser.Scale.Center.CENTER_BOTH,resizeInterval:1},width:600,height:800,backgroundColor:"#000000"};class p extends s.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new p(f)}))}},i={};function s(e){var a=i[e];if(void 0!==a)return a.exports;var n=i[e]={exports:{}};return t[e].call(n.exports,n,n.exports,s),n.exports}s.m=t,e=[],s.O=(t,i,a,n)=>{if(!i){var r=1/0;for(c=0;c<e.length;c++){for(var[i,a,n]=e[c],l=!0,o=0;o<i.length;o++)(!1&n||r>=n)&&Object.keys(s.O).every((e=>s.O[e](i[o])))?i.splice(o--,1):(l=!1,n<r&&(r=n));if(l){e.splice(c--,1);var h=a();void 0!==h&&(t=h)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[i,a,n]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var a,n,[r,l,o]=i,h=0;if(r.some((t=>0!==e[t]))){for(a in l)s.o(l,a)&&(s.m[a]=l[a]);if(o)var c=o(s)}for(t&&t(i);h<r.length;h++)n=r[h],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(c)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var a=s.O(void 0,[216],(()=>s(579)));a=s.O(a)})();